<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RENCE CREATE | Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Fraunces:ital,opsz,wght@0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">

    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ROOT VARIABLES
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --bg:            #f4f4f4;
            --black:         #000000;
            --accent:        #00ff66;
            --white:         #ffffff;
            --grey:          #e0e0e0;
            --text-muted:    #555555;
            --border:        3px solid var(--black);
            --shadow-sm:     6px 6px 0px var(--black);
            --shadow-lg:     12px 12px 0px var(--black);
            --shadow-accent: 8px 8px 0px var(--accent);
            --ease:          cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition:    all 0.25s var(--ease);
            --danger:        #e00000;
            --success:       var(--accent);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Unbounded', sans-serif;
            background: var(--bg);
            color: var(--black);
            overflow-x: hidden;
            line-height: 1.5;
            padding-top: 80px;
            padding-bottom: 60px;
        }

        .hidden { display: none !important; }

        h1, h2, h3, .serif {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-weight: 400;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           FIXED HEADER
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            position: fixed;
            top: 16px;
            left: 16px;
            right: 16px;
            z-index: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 28px;
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: var(--border);
            box-shadow: var(--shadow-sm);
        }

        .logo {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 1.3rem;
            letter-spacing: -1.5px;
            color: var(--black);
            text-decoration: none;
        }

        .header-right { display: flex; align-items: center; gap: 12px; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           INPUTS & BUTTONS
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        input, textarea, select {
            width: 100%;
            padding: 11px 14px;
            border: 2px solid var(--black);
            border-radius: 0;
            background: var(--white);
            font-family: 'Unbounded', sans-serif;
            font-size: 0.7rem;
            color: var(--black);
            margin-bottom: 10px;
            transition: box-shadow 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 4px 4px 0px var(--accent);
        }

        button {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 12px 22px;
            cursor: pointer;
            transition: var(--transition);
        }

        button:hover {
            background: var(--accent);
            color: var(--black);
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--black);
        }

        button.btn-ghost { background: var(--grey); color: #444; }
        button.btn-ghost:hover { background: var(--grey); color: var(--black); box-shadow: 3px 3px 0px var(--black); }
        button.btn-danger  { background: var(--danger); color: var(--white); }
        button.btn-success { background: var(--accent); color: var(--black); border: 2px solid var(--black); }

        .cart-btn {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            text-decoration: none;
            display: inline-block;
        }
        .cart-btn:hover {
            background: var(--accent);
            color: var(--black);
            transform: translateY(-3px);
            box-shadow: 4px 4px 0px var(--black);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ADMIN DASHBOARD
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #admin-page {
            max-width: 1140px;
            margin: 40px auto;
            padding: 0 24px 80px;
        }

        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: var(--border);
            flex-wrap: wrap;
            gap: 12px;
        }

        .admin-header h2 {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-size: 2rem;
        }

        .admin-header-actions { display: flex; gap: 10px; flex-wrap: wrap; }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 28px;
        }

        .admin-panel {
            background: var(--white);
            border: var(--border);
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }

        .admin-panel h4 {
            font-size: 0.6rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            margin-bottom: 14px;
        }

        /* Shop Status toggle */
        .shop-status-panel {
            background: var(--white);
            border: var(--border);
            padding: 20px 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 24px;
            flex-wrap: wrap;
        }

        .shop-status-panel .status-label {
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .toggle-track {
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: var(--grey);
            border: 2px solid var(--black);
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--black);
            transition: transform 0.2s ease;
        }

        .toggle-switch.on { background: var(--accent); }
        .toggle-switch.on::after { transform: translateX(28px); }

        .toggle-status-text {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .toggle-status-text.open  { color: var(--accent); }
        .toggle-status-text.closed { color: var(--danger); }

        .admin-shop-area {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .admin-sidebar {
            width: 200px;
            flex-shrink: 0;
            border: var(--border);
            background: var(--white);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .admin-sidebar-title {
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            padding: 14px 16px 10px;
            border-bottom: 2px solid var(--black);
        }

        .admin-folder-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--grey);
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--black);
            cursor: pointer;
            transition: background 0.15s;
        }

        .admin-folder-btn:hover { background: var(--bg); transform: none; box-shadow: none; color: var(--black); }
        .admin-folder-btn.active { background: var(--black); color: var(--accent); box-shadow: none; transform: none; }

        .admin-table-wrap {
            flex: 1;
            border: var(--border);
            background: var(--white);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            overflow-x: auto;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 400px;
        }

        .admin-table thead tr { background: var(--black); color: var(--white); }

        .admin-table thead th {
            text-align: left;
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 12px 16px;
        }

        .admin-table tbody tr { border-bottom: 1px solid var(--grey); transition: background 0.15s; }
        .admin-table tbody tr:hover { background: var(--bg); }

        .admin-table td {
            padding: 12px 16px;
            font-size: 0.7rem;
            vertical-align: middle;
        }

        .admin-table .prod-name { font-weight: 900; text-transform: uppercase; }
        .admin-table .prod-sub  { font-size: 0.6rem; color: var(--text-muted); margin-top: 2px; }

        .badge-live {
            background: var(--accent);
            color: var(--black);
            border: 2px solid var(--black);
            padding: 4px 12px;
            font-size: 0.6rem;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--transition);
        }

        .badge-off {
            background: var(--grey);
            color: #777;
            border: 2px solid #bbb;
            padding: 4px 12px;
            font-size: 0.6rem;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--transition);
        }

        .badge-live:hover, .badge-off:hover { transform: translate(-2px, -2px); box-shadow: 3px 3px 0px var(--black); }

        .admin-edit-btn {
            background: transparent;
            border: 2px solid var(--black);
            color: var(--black);
            padding: 5px 14px;
            font-size: 0.6rem;
        }

        .admin-edit-btn:hover { background: var(--black); color: var(--accent); transform: translate(-2px,-2px); box-shadow: 3px 3px 0px var(--accent); }

        .admin-table-empty {
            padding: 48px;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
            font-style: italic;
            font-family: 'Fraunces', serif;
        }

        /* Category Manager */
        .cat-manager-item { border-top: 2px solid var(--grey); padding: 16px 0; }
        .cat-manager-item:first-child { border-top: none; }

        .cat-manager-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cat-folder-name { font-size: 0.75rem; font-weight: 900; text-transform: uppercase; }

        .btn-del-folder { background: none; border: 1px solid var(--danger); color: var(--danger); font-size: 0.6rem; padding: 4px 10px; cursor: pointer; transition: var(--transition); }
        .btn-del-folder:hover { background: var(--danger); color: var(--white); transform: translate(-2px,-2px); box-shadow: 3px 3px 0px var(--black); }

        .sub-tags-wrap { display: flex; flex-wrap: wrap; gap: 8px; margin-left: 16px; margin-bottom: 10px; }

        .sub-tag { background: var(--accent); border: 1px solid var(--black); padding: 4px 10px; font-size: 0.6rem; font-weight: 900; display: flex; align-items: center; gap: 6px; }
        .sub-tag-del { cursor: pointer; font-weight: 900; color: var(--black); line-height: 1; }

        .sub-add-row { display: flex; gap: 8px; margin-left: 16px; }
        .sub-add-row input { font-size: 0.65rem; padding: 7px 10px; margin: 0; flex: 1; }
        .sub-add-row button { font-size: 0.6rem; padding: 7px 14px; flex-shrink: 0; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.87);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-card {
            background: var(--white);
            border: var(--border);
            width: 100%;
            max-width: 460px;
            padding: 32px;
            box-shadow: 14px 14px 0px var(--accent);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .modal-actions button { flex: 1; }

        /* Upload sections */
        .upload-section-label {
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            display: block;
            margin-bottom: 8px;
        }

        .upload-section {
            margin-bottom: 16px;
            padding: 14px;
            border: 2px dashed var(--black);
            background: var(--bg);
        }

        #icon-preview-wrap { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }

        .icon-slot {
            position: relative;
            width: 80px; height: 80px;
            border: var(--border);
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-muted);
            overflow: hidden;
            flex-shrink: 0;
        }
        .icon-slot img { width: 100%; height: 100%; object-fit: cover; }

        .display-slots-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .img-slot {
            position: relative;
            aspect-ratio: 1 / 1;
            border: 2px solid var(--black);
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            overflow: hidden;
        }
        .img-slot img { width: 100%; height: 100%; object-fit: cover; display: block; }

        .img-slot-del {
            position: absolute;
            top: 3px; right: 3px;
            width: 22px; height: 22px;
            background: var(--black);
            color: var(--accent);
            border: none;
            font-size: 0.8rem;
            font-weight: 900;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            padding: 0;
            transition: background 0.15s, color 0.15s;
        }
        .img-slot-del:hover { background: var(--danger); color: var(--white); transform: none; box-shadow: none; }

        #upload-progress-wrap { height: 6px; background: var(--grey); border: 1px solid var(--black); margin-bottom: 8px; overflow: hidden; }
        #upload-progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s ease; }

        /* Toast */
        #custom-alert {
            position: fixed;
            bottom: 32px;
            right: 24px;
            background: var(--black);
            color: var(--white);
            padding: 14px 22px;
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transform: translateY(calc(100% + 60px));
            opacity: 0;
            pointer-events: none;
            transition: transform 0.45s var(--ease), opacity 0.45s ease;
            z-index: 9999;
            box-shadow: 5px 5px 0px var(--accent);
            max-width: 320px;
        }
        #custom-alert.show { transform: translateY(0); opacity: 1; pointer-events: auto; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOBILE â€” admin-panel.html
           All rules inside @media (max-width: 767px) â€” desktop untouched
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Tab bar: hidden on desktop */
        #mobile-tab-bar { display: none; }

        @media (max-width: 767px) {

            :root {
                --tab-h:    64px;
                --tab-safe: max(env(safe-area-inset-bottom, 0px), 8px);
                --tab-tot:  calc(var(--tab-h) + var(--tab-safe));
            }

            html, body { -webkit-overflow-scrolling: touch; }
            *, *::before, *::after { box-sizing: border-box; }

            body {
                padding-top: 0 !important;
                padding-bottom: var(--tab-tot) !important;
            }

            a, button, [role="button"] {
                -webkit-touch-callout: none;
                -webkit-tap-highlight-color: rgba(0,255,102,0.18);
            }

            /* â”€â”€ HIDE desktop header â”€â”€ */
            header { display: none !important; }

            /* â”€â”€ FIXED BOTTOM TAB BAR â”€â”€ */
            #mobile-tab-bar {
                display: flex !important;
                position: fixed;
                bottom: 0; left: 0; right: 0;
                z-index: 900;
                height: var(--tab-tot);
                padding-bottom: var(--tab-safe);
                background: rgba(255,255,255,0.97);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                border-top: 3px solid var(--black);
                box-shadow: 0 -4px 0 var(--black);
                align-items: stretch;
            }
            #mobile-tab-bar .tab-item {
                flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
                gap: 3px; text-decoration: none; color: var(--black);
                font-family: 'Unbounded', sans-serif; font-size: 0.48rem; font-weight: 700;
                text-transform: uppercase; letter-spacing: 0.3px;
                cursor: pointer; background: transparent; border: none; padding: 0;
                min-height: 44px; position: relative;
                transition: color 0.15s ease, background 0.15s ease;
                -webkit-tap-highlight-color: transparent;
            }
            #mobile-tab-bar .tab-item .tab-icon { font-size: 1.3rem; line-height: 1; display: block; transition: transform 0.18s ease; }
            #mobile-tab-bar .tab-item .tab-label { display: block; line-height: 1; }
            #mobile-tab-bar .tab-item.active::after { content: ''; position: absolute; top: 0; left: 20%; right: 20%; height: 3px; background: var(--accent); }
            #mobile-tab-bar .tab-item.active .tab-icon { transform: translateY(-2px) scale(1.12); }
            #mobile-tab-bar .tab-item:active { background: rgba(0,255,102,0.12); }

            /* â”€â”€ TOUCH INTERACTIONS â”€â”€ */
            button:hover { transform: none; box-shadow: none; }
            button:active { transform: translate(-2px,-2px); box-shadow: 3px 3px 0px var(--accent); background: var(--accent); color: var(--black); transition: transform 0.08s ease; }
            button.btn-ghost:active { background: var(--grey); color: var(--black); box-shadow: 3px 3px 0px var(--black); }
            button.btn-danger:active { background: var(--danger); color: var(--white); transform: translate(-2px,-2px); }
            button.btn-success:active { background: var(--accent); color: var(--black); }
            .admin-folder-btn:hover { background: var(--bg); transform: none; box-shadow: none; color: var(--black); }
            .admin-folder-btn:active { background: var(--black); color: var(--accent); }
            .badge-live:hover, .badge-off:hover { transform: none; box-shadow: none; }
            .badge-live:active, .badge-off:active { transform: translate(-2px,-2px); box-shadow: 3px 3px 0px var(--black); }
            .admin-edit-btn:hover { background: transparent; color: var(--black); transform: none; box-shadow: none; }
            .admin-edit-btn:active { background: var(--black); color: var(--accent); transform: translate(-2px,-2px); }

            /* â”€â”€ 44px TAP TARGETS â”€â”€ */
            button, a { min-height: 44px; }
            input:not([type="file"]):not([type="checkbox"]), textarea, select { min-height: 44px; font-size: 16px !important; }
            input[type="file"] { min-height: 44px; padding: 10px 0; }
            .admin-folder-btn { min-height: 44px; }
            .badge-live, .badge-off { min-height: 40px; display: inline-flex; align-items: center; }
            .admin-edit-btn { min-height: 40px; display: inline-flex; align-items: center; }
            .toggle-track { min-height: 44px; }

            /* â”€â”€ ADMIN PAGE LAYOUT â”€â”€ */
            #admin-page { padding: 24px 12px; margin: 0 auto; }

            /* Admin header: stack vertically */
            .admin-header { flex-direction: column; align-items: flex-start; gap: 16px; margin-bottom: 24px; }
            .admin-header h2 { font-size: 1.6rem; }

            /* Action buttons: 2-column grid */
            .admin-header-actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                width: 100%;
            }
            .admin-header-actions button { width: 100%; white-space: nowrap; font-size: 0.58rem; padding: 12px 8px; min-height: 44px; }

            /* Shop status panel: stack */
            .shop-status-panel { flex-direction: column; gap: 16px; padding: 16px; }

            /* Controls grid: 1-col */
            .admin-controls { grid-template-columns: 1fr; gap: 12px; margin-bottom: 20px; }

            /* Shop area: sidebar above table */
            .admin-shop-area { flex-direction: column; gap: 0; }

            /* Sidebar: horizontal scrollable pill row */
            .admin-sidebar {
                width: 100%; border-right: none; border-bottom: var(--border);
                padding: 0 0 12px; margin-bottom: 16px;
                min-width: unset; max-width: 100%;
            }
            .admin-sidebar-title { padding: 12px 0 8px; }

            .admin-sidebar-buttons {
                display: flex; flex-wrap: nowrap;
                overflow-x: auto; -webkit-overflow-scrolling: touch;
                gap: 0; scrollbar-width: none; -ms-overflow-style: none;
            }
            .admin-sidebar-buttons::-webkit-scrollbar { display: none; }
            .admin-folder-btn { white-space: nowrap; border-right: 1px solid var(--grey); border-bottom: none; padding: 12px 16px; }

            /* Table: card-based layout on mobile */
            .admin-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .admin-table { font-size: 0.65rem; min-width: unset; }
            .admin-table thead { display: none; }
            .admin-table tbody tr {
                display: block; border: 2px solid var(--black);
                margin-bottom: 12px; padding: 12px; background: var(--white);
            }
            .admin-table td {
                display: block; padding: 4px 0; border: none; text-align: left !important;
            }

            /* â”€â”€ MODALS: bottom-sheet style â”€â”€ */
            .modal-overlay {
                padding: 0; align-items: flex-end;
                overflow-y: auto; overscroll-behavior: contain;
                -webkit-overflow-scrolling: touch; contain: layout style;
            }

            .modal-card {
                width: 100% !important; max-width: 100% !important;
                min-width: 0; padding: 24px 18px;
                border-radius: 16px 16px 0 0 !important;
                border-bottom: none !important;
                max-height: 88vh; overflow-y: auto; overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
                box-shadow: 0 -5px 0 var(--accent); margin: 0;
            }

            /* Drag handle hint */
            .modal-card::before {
                content: ''; display: block;
                width: 36px; height: 4px; background: var(--grey);
                border-radius: 2px; margin: 0 auto 18px;
            }

            .modal-actions { flex-direction: column; gap: 10px; margin-top: 16px; }
            .modal-actions button { width: 100%; flex: none; padding: 14px 16px; min-height: 44px; }

            /* Confirm dialog */
            #confirm-standard-btns { flex-direction: column; gap: 10px; }
            #confirm-standard-btns button { width: 100%; min-height: 44px; }

            /* Upload inputs */
            .upload-section input[type="file"] { width: 100%; box-sizing: border-box; }
            .modal-card input, .modal-card textarea, .modal-card select { width: 100%; box-sizing: border-box; }
            .display-slots-grid { grid-template-columns: repeat(4, 1fr); }

            /* Toast: above tab bar */
            #custom-alert { bottom: calc(var(--tab-tot) + 12px); right: 12px; left: 12px; max-width: none; }
        }

        @media (max-width: 480px) {
            .admin-header h2 { font-size: 1.4rem; }
            .admin-header-actions { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- â”€â”€ Toast â”€â”€ -->
<div id="custom-alert">
    <span id="alert-icon">âœ¨</span>
    <span id="alert-text">Action Successful</span>
</div>

<!-- â”€â”€ Confirm Dialog â”€â”€ -->
<div id="confirm-panel" class="modal-overlay hidden">
    <div class="modal-card">
        <p id="confirm-msg" style="font-size:0.85rem; font-weight:700; margin-bottom:24px; line-height:1.5;"></p>
        <div id="confirm-standard-btns" style="display:flex; gap:10px;">
            <button id="confirm-yes" style="flex:1;">Yes</button>
            <button onclick="closeConfirm()" class="btn-ghost" style="flex:1;">No</button>
        </div>
    </div>
</div>

<!-- â”€â”€ Admin Product Modal â”€â”€ -->
<div id="admin-modal" class="modal-overlay hidden">
    <div class="modal-card">
        <h2 id="modal-header-text" style="font-family:'Fraunces',serif; font-style:italic; margin-bottom:20px;">Product Panel</h2>

        <div class="upload-section">
            <span class="upload-section-label">â‘  Product Icon â€” single square image</span>
            <div id="icon-preview-wrap">
                <div class="img-slot icon-slot" id="icon-slot" style="width:80px;height:80px;flex-shrink:0;">Empty</div>
                <div>
                    <input type="file" id="icon-upload" accept="image/*"
                           style="font-size:0.62rem; margin:0 0 6px;">
                    <p style="font-size:0.55rem; color:var(--text-muted); margin:0; line-height:1.5;">
                        Shown on the shop grid (1:1 square)
                    </p>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <span class="upload-section-label">â‘¡ Display Images â€” up to 4 (shown in product viewer)</span>
            <div class="display-slots-grid" id="display-slots-grid"></div>
            <input type="file" id="display-upload" accept="image/*" multiple
                   style="font-size:0.62rem; margin:0 0 6px;">
            <div id="upload-progress-wrap" class="hidden">
                <div id="upload-progress-bar"></div>
            </div>
            <p id="upload-status-text" class="hidden"
               style="font-size:0.6rem; color:var(--text-muted); margin:4px 0 0;">Processing...</p>
        </div>

        <input type="text"   id="p-title" placeholder="Product Title">
        <textarea            id="p-desc"  placeholder="Product Description..." style="height:80px; resize:vertical;"></textarea>
        <div style="display:flex; gap:10px;">
            <input type="number" id="p-price" placeholder="Price (â‚±)">
            <input type="number" id="p-stock" placeholder="Stock">
        </div>

        <div id="modal-footer" class="modal-actions"></div>
    </div>
</div>

<!-- â”€â”€ Category Manager Modal â”€â”€ -->
<div id="cat-manager-modal" class="modal-overlay hidden">
    <div class="modal-card" style="max-width:560px;">
        <h2 style="font-family:'Fraunces',serif; font-style:italic; margin-bottom:20px;">Folder Manager</h2>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input type="text" id="mgr-new-cat" placeholder="New folder name..." style="flex:1; margin:0;">
            <button onclick="mgrAddFolder()">+ Folder</button>
        </div>
        <div id="mgr-list"></div>
        <div style="margin-top:24px; border-top:2px solid var(--black); padding-top:16px;">
            <button onclick="closeModals()" class="btn-ghost" style="width:100%;">Close</button>
        </div>
    </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIXED HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header>
    <a href="main-shop.html" class="logo">RENCE CREATE</a>
    <div class="header-right">
        <a href="main-shop.html" class="cart-btn" style="text-decoration:none;">â† SHOP</a>
    </div>
</header>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-page">

    <div class="admin-header">
        <h2>Admin Dashboard</h2>
        <div class="admin-header-actions">
            <button onclick="openCatManager()">ğŸ“ Folders</button>
            <button onclick="openAdminModal()" style="background:#333;">+ Product</button>
            <button onclick="saveAdminChanges()" class="btn-success">Save Changes</button>
            <button onclick="logout()" class="btn-danger">Logout</button>
        </div>
    </div>

    <!-- Shop Status Control Panel -->
    <div class="shop-status-panel">
        <div>
            <div class="status-label">Shop Status</div>
            <div class="toggle-track" onclick="toggleShopStatus()">
                <div class="toggle-switch" id="status-toggle"></div>
                <span class="toggle-status-text" id="status-toggle-label">OPEN</span>
            </div>
        </div>
        <div style="flex:1; min-width:260px;">
            <div class="status-label">Closed Shop Message</div>
            <textarea id="closed-msg-input" placeholder="e.g. We're restocking! Back on Friday. â™¡" style="height:72px; resize:vertical; font-size:0.7rem; margin:0;"></textarea>
        </div>
    </div>

    <div class="admin-shop-area">
        <!-- Folder sidebar -->
        <div class="admin-sidebar">
            <div class="admin-sidebar-title">Folders</div>
            <div class="admin-sidebar-buttons" id="admin-sidebar"></div>
        </div>

        <!-- Product table -->
        <div class="admin-table-wrap">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="admin-list"></tbody>
            </table>
        </div>
    </div>

</div><!-- /#admin-page -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MOBILE BOTTOM TAB BAR â€” hidden on desktop via CSS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="mobile-tab-bar" aria-label="Admin navigation">

    <!-- Back to Shop -->
    <a href="main-shop.html" class="tab-item" aria-label="Back to shop">
        <span class="tab-icon">ğŸ›</span>
        <span class="tab-label">Shop</span>
    </a>

    <!-- Add Product: active on this panel -->
    <button class="tab-item active" onclick="openAdminModal()" aria-label="Add product">
        <span class="tab-icon">â•</span>
        <span class="tab-label">Add</span>
    </button>

    <!-- Save Changes -->
    <button class="tab-item" onclick="saveAdminChanges()" aria-label="Save changes">
        <span class="tab-icon">ğŸ’¾</span>
        <span class="tab-label">Save</span>
    </button>

    <!-- Logout -->
    <button class="tab-item" onclick="logout()" aria-label="Logout">
        <span class="tab-icon">ğŸšª</span>
        <span class="tab-label">Logout</span>
    </button>

</nav>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
    /* â”€â”€â”€ AUTH GUARD â”€â”€â”€ */
    if (localStorage.getItem('rc_is_admin') !== '1') {
        window.location.href = 'index.html';
    }

    /* â”€â”€â”€ SUPABASE â”€â”€â”€ */
    const SUPABASE_URL = 'https://wogftjsssxfhktgdfvod.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_9yJg8M-wrRXHMfuDnCtFkA_L3n1Ii36';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    /* â”€â”€â”€ STATE â”€â”€â”€ */
    let categories           = { "Stickers": [], "Pins": [] };
    let catalog              = [];
    let adminCurrentCategory = "";
    let tempIcon             = null;
    let tempDisplayImages    = [];
    let editingIdx           = null;
    let isShopOpen           = true;
    let closedShopMessage    = "";
    let confirmCallback      = null;

    /* â”€â”€â”€ NOTIFICATIONS â”€â”€â”€ */
    let _notifyTimer = null;
    function notify(text, icon = "âœ¨") {
        const box = document.getElementById('custom-alert');
        document.getElementById('alert-text').innerText = text;
        document.getElementById('alert-icon').innerText = icon;
        if (_notifyTimer) { clearTimeout(_notifyTimer); _notifyTimer = null; }
        box.classList.remove('show');
        void box.offsetWidth;
        box.classList.add('show');
        _notifyTimer = setTimeout(() => {
            box.classList.remove('show');
            _notifyTimer = null;
        }, 3000);
    }

    /* â”€â”€â”€ CONFIRM DIALOG â”€â”€â”€ */
    function customConfirm(msg, callback) {
        document.getElementById('confirm-msg').innerText = msg;
        document.getElementById('confirm-panel').classList.remove('hidden');
        confirmCallback = callback;
    }

    function closeConfirm() { document.getElementById('confirm-panel').classList.add('hidden'); }
    document.getElementById('confirm-yes').onclick = () => { confirmCallback(); closeConfirm(); };

    /* â”€â”€â”€ DATA LOADING â”€â”€â”€ */
    async function loadAllData() {
        const { data: setts } = await supabaseClient.from('settings').select('*').single();
        if (setts) {
            categories = (setts.category_list && !Array.isArray(setts.category_list))
                ? setts.category_list
                : { "Stickers": [], "Pins": [] };
            isShopOpen        = setts.is_shop_open !== false;
            closedShopMessage = setts.closed_shop_message || "";
        }
        const { data: prods } = await supabaseClient.from('products').select('*');
        if (prods) catalog = prods.map(p => ({ ...p, cartQty: 0 }));

        const firstCat = Object.keys(categories)[0] || "";
        adminCurrentCategory = firstCat;
    }

    /* â”€â”€â”€ LOGOUT â”€â”€â”€ */
    function logout() {
        localStorage.removeItem('rc_is_admin');
        sessionStorage.removeItem('rc_username');
        window.location.href = 'index.html';
    }

    /* â”€â”€â”€ SHOP STATUS â”€â”€â”€ */
    function syncShopStatusUI() {
        const toggle   = document.getElementById('status-toggle');
        const label    = document.getElementById('status-toggle-label');
        const msgInput = document.getElementById('closed-msg-input');
        if (!toggle) return;
        if (isShopOpen) {
            toggle.classList.add('on');
            label.textContent = 'OPEN';
            label.className   = 'toggle-status-text open';
        } else {
            toggle.classList.remove('on');
            label.textContent = 'CLOSED';
            label.className   = 'toggle-status-text closed';
        }
        if (msgInput) msgInput.value = closedShopMessage;
    }

    function toggleShopStatus() {
        isShopOpen = !isShopOpen;
        syncShopStatusUI();
    }

    /* â”€â”€â”€ ADMIN SIDEBAR â”€â”€â”€ */
    function renderAdminSidebar() {
        const sidebar = document.getElementById('admin-sidebar');
        sidebar.innerHTML = '';
        Object.keys(categories).forEach(catName => {
            const btn = document.createElement('button');
            btn.className = `admin-folder-btn${adminCurrentCategory === catName ? ' active' : ''}`;
            btn.textContent = catName;
            btn.onclick = () => {
                adminCurrentCategory = catName;
                renderAdminSidebar();
                renderAdminTable();
            };
            sidebar.appendChild(btn);
        });
    }

    /* â”€â”€â”€ ADMIN TABLE â”€â”€â”€ */
    function renderAdminTable() {
        const tbody = document.getElementById('admin-list');
        tbody.innerHTML = '';

        const items = catalog.filter(item => item.category === adminCurrentCategory);

        if (items.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" class="admin-table-empty">No products in this folder yet.</td></tr>`;
            return;
        }

        items.forEach(item => {
            const i = catalog.indexOf(item);
            const isLive = item.status === 'live';
            const tr = document.createElement('tr');
            tr.id = `row-${i}`;
            tr.innerHTML = `
                <td>
                    <div class="prod-name">${item.name}</div>
                    <div class="prod-sub">${item.subcategory || 'â€”'}</div>
                </td>
                <td><span style="background:var(--accent);padding:2px 8px;font-weight:900;">â‚±${item.price.toFixed(2)}</span></td>
                <td>
                    <button onclick="toggleLiveStatus(${i})" class="${isLive ? 'badge-live' : 'badge-off'}">
                        ${isLive ? 'â— LIVE' : 'â—‹ OFF'}
                    </button>
                </td>
                <td><button onclick="openAdminModal(${i})" class="admin-edit-btn">Edit</button></td>`;
            tbody.appendChild(tr);
        });
    }

    function toggleLiveStatus(idx) {
        catalog[idx].status = catalog[idx].status === 'live' ? 'offline' : 'live';
        renderAdminTable();
        syncItemToCloud(idx);
    }

    /* â”€â”€â”€ SAVE ADMIN CHANGES â”€â”€â”€ */
    async function saveAdminChanges() {
        const btn = event.target;
        btn.textContent = "â³ Saving...";
        const msgEl = document.getElementById('closed-msg-input');
        if (msgEl) closedShopMessage = msgEl.value.trim();
        await supabaseClient.from('settings').upsert({
            id:                   1,
            category_list:        categories,
            is_shop_open:         isShopOpen,
            closed_shop_message:  closedShopMessage
        });
        notify("All changes saved!", "ğŸ’¾");
        btn.textContent = "Save Changes";
    }

    /* â”€â”€â”€ CATEGORY MANAGER â”€â”€â”€ */
    function openCatManager() {
        renderCategoryManager();
        document.getElementById('cat-manager-modal').classList.remove('hidden');
    }

    function renderCategoryManager() {
        const list = document.getElementById('mgr-list');
        list.innerHTML = '';

        Object.keys(categories).forEach(cat => {
            const div = document.createElement('div');
            div.className = 'cat-manager-item';
            div.innerHTML = `
                <div class="cat-manager-header">
                    <span class="cat-folder-name">ğŸ“ ${cat}</span>
                    <button class="btn-del-folder" onclick="mgrDelFolder('${cat}')">Delete</button>
                </div>
                <div class="sub-tags-wrap" id="mgr-subs-${cat}"></div>
                <div class="sub-add-row">
                    <input type="text" id="in-sub-${cat}" placeholder="New sub-category...">
                    <button onclick="mgrAddSub('${cat}')">+ Add</button>
                </div>`;
            list.appendChild(div);

            const subWrap = document.getElementById(`mgr-subs-${cat}`);
            categories[cat].forEach(sub => {
                const tag = document.createElement('span');
                tag.className = 'sub-tag';
                tag.innerHTML = `${sub} <b class="sub-tag-del" onclick="mgrDelSub('${cat}','${sub}')">Ã—</b>`;
                subWrap.appendChild(tag);
            });
        });
    }

    function mgrAddFolder() {
        const name = document.getElementById('mgr-new-cat').value.trim();
        if (name && !categories[name]) {
            categories[name] = [];
            document.getElementById('mgr-new-cat').value = '';
            renderCategoryManager();
            renderAdminSidebar();
            notify("Folder created!", "ğŸ“");
        }
    }

    function mgrDelFolder(cat) {
        customConfirm(`Delete "${cat}" and all its sub-categories?`, () => {
            delete categories[cat];
            if (adminCurrentCategory === cat) adminCurrentCategory = Object.keys(categories)[0] || "";
            renderCategoryManager();
            renderAdminSidebar();
            renderAdminTable();
            notify("Folder deleted.", "ğŸ—‘ï¸");
        });
    }

    function mgrAddSub(cat) {
        const name = document.getElementById(`in-sub-${cat}`).value.trim();
        if (name && !categories[cat].includes(name)) {
            categories[cat].push(name);
            renderCategoryManager();
            notify("Sub-category added!");
        }
    }

    function mgrDelSub(cat, sub) {
        categories[cat] = categories[cat].filter(s => s !== sub);
        renderCategoryManager();
    }

    /* â”€â”€â”€ PRODUCT MODAL â”€â”€â”€ */
    function openAdminModal(idx = null) {
        editingIdx        = idx;
        tempIcon          = idx !== null ? (catalog[idx].product_icon || null)       : null;
        tempDisplayImages = idx !== null ? [...(catalog[idx].display_images || [])]  : [];

        document.getElementById('p-title').value = idx !== null ? catalog[idx].name        : "";
        document.getElementById('p-desc').value  = idx !== null ? catalog[idx].description : "";
        document.getElementById('p-price').value = idx !== null ? catalog[idx].price       : "";
        document.getElementById('p-stock').value = idx !== null ? catalog[idx].stock       : "";
        document.getElementById('modal-header-text').innerText = idx !== null ? 'Edit Product' : 'New Product';

        document.querySelectorAll('.dynamic-cat-field').forEach(el => el.remove());

        const titleInput = document.getElementById('p-title');

        const catSelect = document.createElement('select');
        catSelect.id = 'p-category';
        catSelect.className = 'dynamic-cat-field';
        catSelect.onchange = () => updateSubcatDropdown();
        Object.keys(categories).forEach(cat => {
            const opt = document.createElement('option');
            opt.value = opt.innerText = cat;
            if (idx !== null && catalog[idx].category === cat) opt.selected = true;
            catSelect.appendChild(opt);
        });

        const subSelect = document.createElement('select');
        subSelect.id = 'p-subcategory';
        subSelect.className = 'dynamic-cat-field';

        titleInput.after(catSelect, subSelect);
        updateSubcatDropdown(idx !== null ? catalog[idx].subcategory : "");

        const footer = document.getElementById('modal-footer');
        footer.innerHTML = '';
        const saveBtn = document.createElement('button');
        saveBtn.style.flex = '2';
        saveBtn.textContent = idx !== null ? 'Save Changes' : 'Add Product';
        saveBtn.onclick = saveProduct;
        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'btn-ghost';
        cancelBtn.style.flex = '1';
        cancelBtn.textContent = 'Cancel';
        cancelBtn.onclick = closeModals;
        footer.appendChild(saveBtn);
        footer.appendChild(cancelBtn);

        if (idx !== null) {
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn-danger';
            deleteBtn.style.cssText = 'width:100%; margin-top:10px;';
            deleteBtn.textContent = 'ğŸ—‘ Delete Product';
            deleteBtn.onclick = () => {
                customConfirm(`Delete "${catalog[idx].name}"? This cannot be undone.`, async () => {
                    await supabaseClient.from('products').delete().eq('id', catalog[idx].id);
                    catalog.splice(idx, 1);
                    closeModals();
                    renderAdminTable();
                    notify("Product deleted.", "ğŸ—‘ï¸");
                });
            };
            footer.appendChild(deleteBtn);
        }

        renderIconPreview();
        renderDisplayPreviews();
        document.getElementById('admin-modal').classList.remove('hidden');
    }

    function updateSubcatDropdown(selectedSub = "") {
        const cat = document.getElementById('p-category').value;
        const subSelect = document.getElementById('p-subcategory');
        subSelect.innerHTML = '<option value="">(No Subcategory)</option>';
        (categories[cat] || []).forEach(sub => {
            const opt = document.createElement('option');
            opt.value = opt.innerText = sub;
            if (sub === selectedSub) opt.selected = true;
            subSelect.appendChild(opt);
        });
    }

    function renderIconPreview() {
        const slot = document.getElementById('icon-slot');
        if (!slot) return;
        if (tempIcon) {
            slot.innerHTML = `
                <img src="${tempIcon}" alt="Icon">
                <button class="img-slot-del" onclick="deleteIcon()" title="Remove icon">Ã—</button>`;
        } else {
            slot.innerHTML = 'Empty';
        }
    }

    function deleteIcon() {
        tempIcon = null;
        renderIconPreview();
    }

    function renderDisplayPreviews() {
        const grid = document.getElementById('display-slots-grid');
        if (!grid) return;
        grid.innerHTML = '';
        for (let i = 0; i < 4; i++) {
            const slot = document.createElement('div');
            slot.className = 'img-slot';
            if (tempDisplayImages[i]) {
                const capturedI = i;
                slot.innerHTML = `
                    <img src="${tempDisplayImages[i]}" alt="Display ${i+1}">
                    <button class="img-slot-del" onclick="deleteDisplayImage(${capturedI})" title="Remove">Ã—</button>`;
            } else {
                slot.innerHTML = `<span style="text-align:center;line-height:1.4;">${i+1}<br>Empty</span>`;
            }
            grid.appendChild(slot);
        }
    }

    function deleteDisplayImage(i) {
        tempDisplayImages.splice(i, 1);
        renderDisplayPreviews();
    }

    /* â”€â”€â”€ SAVE PRODUCT â”€â”€â”€ */
    async function saveProduct() {
        const name = document.getElementById('p-title').value.trim();
        if (!name) { notify("Product name is required!", "âš ï¸"); return; }

        const data = {
            name,
            description:    document.getElementById('p-desc').value,
            price:          parseFloat(document.getElementById('p-price').value) || 0,
            stock:          parseInt(document.getElementById('p-stock').value)   || 0,
            product_icon:   tempIcon,
            display_images: tempDisplayImages,
            category:       document.getElementById('p-category').value,
            subcategory:    document.getElementById('p-subcategory').value,
            status:         editingIdx !== null ? catalog[editingIdx].status : 'offline'
        };

        if (editingIdx !== null) {
            catalog[editingIdx] = { ...catalog[editingIdx], ...data };
        } else {
            catalog.push({ ...data, id: Date.now(), cartQty: 0 });
        }

        closeModals();
        renderAdminTable();
        await syncItemToCloud(editingIdx === null ? catalog.length - 1 : editingIdx);
    }

    /* â”€â”€â”€ CLOUD SYNC â”€â”€â”€ */
    async function syncItemToCloud(idx) {
        try {
            const { cartQty, ...cleanData } = catalog[idx];
            await supabaseClient.from('products').upsert(cleanData);
            notify("Cloud updated!", "â˜ï¸");
        } catch (err) { notify("Sync failed!", "âŒ"); }
    }

    /* â”€â”€â”€ CLOSE MODALS â”€â”€â”€ */
    function closeModals() {
        document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden'));
    }

    /* â”€â”€â”€ IMAGE UPLOAD HANDLERS â”€â”€â”€ */
    document.getElementById('icon-upload').addEventListener('change', async function () {
        const file = this.files[0];
        if (!file) return;
        if (!file.type.startsWith('image/')) { notify("Please select an image file.", "âš ï¸"); return; }
        const reader = new FileReader();
        reader.onload = e => { tempIcon = e.target.result; renderIconPreview(); notify("Icon loaded!", "ğŸ–¼ï¸"); };
        reader.onerror = () => notify("Failed to read icon file.", "âŒ");
        reader.readAsDataURL(file);
        this.value = '';
    });

    document.getElementById('display-upload').addEventListener('change', async function () {
        const files = Array.from(this.files);
        if (!files.length) return;

        const progressWrap = document.getElementById('upload-progress-wrap');
        const progressBar  = document.getElementById('upload-progress-bar');
        const statusText   = document.getElementById('upload-status-text');

        progressWrap.classList.remove('hidden');
        statusText.classList.remove('hidden');
        progressBar.style.width = '0%';

        const slotsLeft = 4 - tempDisplayImages.length;
        if (slotsLeft <= 0) {
            notify("All 4 display slots are full. Delete one first.", "âš ï¸");
            progressWrap.classList.add('hidden');
            statusText.classList.add('hidden');
            this.value = '';
            return;
        }

        const toLoad = files.filter(f => f.type.startsWith('image/')).slice(0, slotsLeft);

        for (let i = 0; i < toLoad.length; i++) {
            await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => {
                    tempDisplayImages.push(e.target.result);
                    progressBar.style.width = `${((i + 1) / toLoad.length) * 100}%`;
                    resolve();
                };
                reader.onerror = reject;
                reader.readAsDataURL(toLoad[i]);
            });
        }

        progressWrap.classList.add('hidden');
        statusText.classList.add('hidden');
        progressBar.style.width = '0%';
        renderDisplayPreviews();
        notify(`${toLoad.length} image${toLoad.length > 1 ? 's' : ''} loaded!`, "ğŸ–¼ï¸");
        this.value = '';
    });

    /* â”€â”€â”€ KEYBOARD: ESC closes modals â”€â”€â”€ */
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeModals();
    });

    /* â”€â”€â”€ INIT â”€â”€â”€ */
    (async function init() {
        await loadAllData();
        syncShopStatusUI();
        renderAdminSidebar();
        renderAdminTable();
    })();
</script>
</body>
</html>
