<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RENCE CREATE | Art Shop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;900&family=Fraunces:ital,opsz,wght@1,9..144,400&display=swap" rel="stylesheet">
    
    <style>
        /* =============================================
           THEME VARIABLES (New Brutalist / Editorial)
           ============================================= */
        :root {
            --bg: #f4f4f4;
            --black: #000000;
            --accent: #00ff66;
            --white: #ffffff;
            --border-width: 3px;
            --shadow-subtle: 6px 6px 0px var(--black);
            --shadow-heavy: 12px 12px 0px var(--black);
            --transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);

            /* Legacy vars used in JS-generated HTML */
            --primary: #000000;
            --primary-hover: #333333;
            --text: #000000;
            --text-light: #555555;
            --danger: #ff0000;
            --success: #00cc44;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Unbounded', sans-serif;
            background-color: var(--bg);
            color: var(--black);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            line-height: 1.4;
        }

        .hidden { display: none !important; }

        h1, h2, h3, .classy { font-family: 'Fraunces', serif; font-style: italic; font-weight: 400; }

        /* =============================================
           HEADER ‚Äî Sticky Glassmorphism
           ============================================= */
        header {
            position: sticky;
            top: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: var(--border-width) solid var(--black);
            margin: 0 20px;
            box-shadow: var(--shadow-subtle);
        }

        .logo {
            font-family: 'Unbounded', sans-serif;
            font-size: 1.4rem;
            font-weight: 900;
            letter-spacing: -1.5px;
            text-decoration: none;
            color: var(--black);
        }

        nav { display: flex; align-items: center; gap: 25px; }

        .nav-link {
            text-decoration: none;
            color: var(--black);
            font-size: 0.75rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
        }

        .nav-link:hover { color: var(--accent); text-shadow: 2px 2px 0px var(--black); }

        .cart-btn {
            background: var(--black);
            color: var(--white);
            padding: 10px 18px;
            border: none;
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .cart-btn:hover {
            background: var(--accent);
            color: var(--black);
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px var(--black);
        }

        /* =============================================
           LAYOUT
           ============================================= */
        .shop-container {
            display: flex;
            gap: 25px;
            margin-top: 20px;
            align-items: stretch;
            height: 65vh;
        }

        /* =============================================
           SIDEBAR ‚Äî Folder Link + Sub-Pill Style
           ============================================= */
        .sidebar {
            width: 25%;
            background: var(--white);
            border: var(--border-width) solid var(--black);
            box-shadow: var(--shadow-subtle);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .sidebar-scroll {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Map sidebar-btn to folder-link style */
        .sidebar-btn {
            display: block;
            width: 100%;
            background: transparent;
            text-align: left;
            padding: 12px 15px;
            border: none;
            cursor: pointer;
            color: var(--black);
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: var(--transition);
            position: relative;
            padding-bottom: 12px;
        }

        .sidebar-btn::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 15px;
            width: 0%;
            height: 3px;
            background: var(--accent);
            transition: var(--transition);
        }

        .sidebar-btn:hover::after { width: calc(100% - 30px); }
        .sidebar-btn:hover { background: transparent; }

        .sidebar-btn.active {
            background: var(--black);
            color: var(--white);
        }

        .sidebar-btn.active::after {
            background: var(--accent);
            width: calc(100% - 30px);
        }

        /* =============================================
           DISPLAY BOX
           ============================================= */
        .display-box {
            width: 75%;
            background: rgba(255, 255, 255, 0.5);
            border: 2px dashed var(--black);
            padding: 30px;
            height: 100%;
            position: relative;
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* =============================================
           ADMIN CARD
           ============================================= */
        .admin-card {
            background: var(--white);
            padding: 30px;
            border: var(--border-width) solid var(--black);
            box-shadow: var(--shadow-subtle);
        }

        .folder-manager {
            background: var(--bg);
            padding: 20px;
            border: 2px solid var(--black);
            margin-bottom: 20px;
        }

        /* =============================================
           MODAL OVERLAY
           ============================================= */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        #confirm-panel { z-index: 3000 !important; }

        /* Map modal-content to checkout-card style */
        .modal-content {
            background: var(--white);
            border: var(--border-width) solid var(--black);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 15px 15px 0px var(--accent);
            position: relative;
        }

        /* The checkout-card used in the theme's modal */
        .checkout-card {
            background: var(--white);
            border: var(--border-width) solid var(--black);
            width: 100%;
            max-width: 450px;
            padding: 30px;
            box-shadow: 15px 15px 0px var(--accent);
            position: relative;
        }

        .invoice-paper {
            border: 2px dashed var(--black);
            padding: 20px;
            margin: 20px 0;
            background: #fafafa;
        }

        .btn-action {
            width: 100%;
            padding: 18px;
            background: var(--black);
            color: var(--white);
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.8rem;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            transition: var(--transition);
        }

        .btn-action:hover {
            transform: translate(-3px, -3px);
            box-shadow: 5px 5px 0px var(--accent);
        }

        .btn-download {
            background: var(--accent);
            color: var(--black);
            border: 3px solid var(--black);
        }

        /* =============================================
           PRODUCT GRID ‚Äî Art-Card Style
           ============================================= */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: var(--white);
            padding: 15px;
            border: var(--border-width) solid var(--black);
            cursor: pointer;
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translate(-6px, -6px);
            box-shadow: var(--shadow-heavy);
        }

        /* Art-grid and art-card for the static/theme section */
        .art-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 40px;
        }

        .art-card {
            border: var(--border-width) solid var(--black);
            background: var(--white);
            padding: 15px;
            transition: var(--transition);
            cursor: pointer;
        }

        .art-card:hover {
            transform: translate(-8px, -8px);
            box-shadow: var(--shadow-heavy);
        }

        .img-container {
            width: 100%;
            aspect-ratio: 1/1;
            border: 2px solid var(--black);
            background: #e8e8e8;
            overflow: hidden;
            position: relative;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .art-card:hover .img-container img { transform: scale(1.1); }

        .card-details {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .card-details h4 {
            margin: 0;
            font-size: 1.1rem;
            text-transform: uppercase;
            font-family: 'Unbounded', sans-serif;
        }

        .card-details small { color: #666; font-weight: 900; font-size: 0.6rem; }

        .price {
            margin: 0;
            font-weight: 900;
            font-size: 1.2rem;
            background: var(--accent);
            padding: 0 5px;
        }

        /* =============================================
           CATEGORY NAV (Folder / Sub-Pill)
           ============================================= */
        .category-section {
            padding: 80px 20px 20px;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .folder-nav {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .folder-link {
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 1.1rem;
            position: relative;
            padding-bottom: 5px;
        }

        .folder-link::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0;
            width: 0%; height: 4px;
            background: var(--accent);
            transition: var(--transition);
        }

        .folder-link.active::after, .folder-link:hover::after { width: 100%; }

        .sub-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .sub-pill {
            padding: 6px 18px;
            border: 2px solid var(--black);
            border-radius: 50px;
            font-size: 0.65rem;
            font-weight: 900;
            background: transparent;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Unbounded', sans-serif;
        }

        .sub-pill:hover, .sub-pill.active {
            background: var(--black);
            color: var(--white);
            transform: scale(1.05);
        }

        /* =============================================
           CART FOOTER
           ============================================= */
        .cart-footer {
            background: var(--white);
            padding: 20px;
            border: var(--border-width) solid var(--black);
            margin-top: 20px;
            box-shadow: var(--shadow-subtle);
        }

        /* =============================================
           TOAST NOTIFICATION
           ============================================= */
        #custom-alert {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--black);
            color: var(--white);
            padding: 15px 25px;
            border: var(--border-width) solid var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateY(150%);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 9999;
            box-shadow: 6px 6px 0px var(--accent);
            font-family: 'Unbounded', sans-serif;
            font-size: 0.75rem;
        }

        #custom-alert.show { transform: translateY(0); }

        /* =============================================
           FORMS / INPUTS / BUTTONS
           ============================================= */
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--black);
            border-radius: 0;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-family: 'Unbounded', sans-serif;
            font-size: 0.75rem;
            background: var(--white);
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 4px 4px 0px var(--accent);
        }

        button {
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.75rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
        }

        button:hover {
            background: var(--accent);
            color: var(--black);
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--black);
        }

        /* =============================================
           QTY CONTROLS
           ============================================= */
        .qty-controls { display: flex; align-items: center; gap: 15px; }

        .qty-btn {
            background: var(--accent);
            color: var(--black);
            width: 35px;
            height: 35px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid var(--black);
            padding: 0;
            font-weight: 900;
        }

        .qty-btn:hover {
            background: var(--black);
            color: var(--accent);
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--accent);
        }

        /* =============================================
           INVOICE / ORDER SHEET
           ============================================= */
        .invoice-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .invoice-summary { margin-top: 20px; text-align: right; }
        .grand-total { font-size: 1.4rem; font-weight: 900; background: var(--accent); padding: 5px 10px; margin-top: 10px; display: inline-block; }
        .note-text { font-size: 0.75rem; color: var(--text-light); margin-top: 5px; font-style: italic; line-height: 1.3; }

        .shipping-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: var(--bg); padding: 15px; border: 2px solid var(--black); }
        .shipping-grid label { font-size: 0.75rem; font-weight: 900; color: var(--text-light); font-family: 'Unbounded', sans-serif; }

        /* =============================================
           PROGRESS BAR
           ============================================= */
        .row-progress-container { width: 100%; background: #e0e0e0; height: 6px; overflow: hidden; margin-top: 5px; }
        .row-progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s ease; border: 1px solid var(--black); }
        .syncing { opacity: 0.6; pointer-events: none; }

        /* =============================================
           IMAGE SLIDER
           ============================================= */
        .slider-container {
            position: relative;
            width: 100%;
            height: 250px;
            background: var(--bg);
            border: 2px solid var(--black);
            overflow: hidden;
            margin-bottom: 15px;
        }

        .slider-wrapper { display: flex; transition: transform 0.3s ease; height: 100%; }
        .slider-wrapper img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; }

        .slider-btn-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--white);
            border: 2px solid var(--black);
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-weight: 900;
            font-family: 'Unbounded', sans-serif;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .slider-btn-nav:hover {
            background: var(--accent);
            color: var(--black);
            transform: translateY(-50%) translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--black);
        }

        /* =============================================
           LOGIN PAGE
           ============================================= */
        #login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
        }

        /* =============================================
           CONTAINER (for shop area)
           ============================================= */
        .container { max-width: 1300px; margin: 0 auto; padding: 40px 20px; }

        /* =============================================
           FOOTER
           ============================================= */
        footer {
            margin-top: 100px;
            padding: 60px 40px;
            background: var(--black);
            color: var(--white);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
            align-items: center;
            font-family: 'Unbounded', sans-serif;
        }

        .est-tag { font-weight: 900; font-size: clamp(1rem, 5vw, 1.5rem); }

        /* =============================================
           MOBILE ADJUSTMENTS
           ============================================= */
        @media (max-width: 768px) {
            header {
                padding: 10px 15px;
                margin: 0 10px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
                top: 10px;
            }

            .shop-container { flex-direction: column; height: auto; gap: 15px; }
            .sidebar { width: 100%; height: auto; padding: 10px; }

            .sidebar-scroll {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
                flex-grow: 0;
            }

            .sidebar-btn {
                white-space: nowrap;
                width: auto;
                padding: 8px 15px;
                font-size: 0.7rem;
            }

            .display-box { width: 100%; padding: 15px; height: auto; min-height: 400px; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .modal-content { width: 95%; padding: 20px; margin: 10px; }

            button, .qty-btn { min-height: 44px; }

            .cart-footer {
                position: sticky;
                bottom: 0;
                left: 0;
                width: 100%;
                margin-top: 0;
                z-index: 1000;
                box-sizing: border-box;
            }

            #admin-page { padding: 10px !important; }
            .admin-card { padding: 15px !important; }

            #admin-page .shop-container { flex-direction: column; }

            #admin-list tr {
                display: flex;
                flex-direction: column;
                border: 2px solid var(--black);
                margin-bottom: 15px;
                padding: 10px;
                background: var(--white);
            }

            #admin-list td {
                border: none;
                width: 100%;
                box-sizing: border-box;
                padding: 5px 0 !important;
                text-align: left !important;
            }

            #admin-page .display-box {
                width: 100%;
                border: none;
                background: transparent;
                overflow-x: auto;
                padding: 5px;
            }

            #admin-page .admin-card > div[style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
            #admin-page > .admin-card > div[style*="display: flex"] { flex-direction: column; }

            .nav-link { display: none; }
            .art-grid { gap: 25px; }
        }
    </style>
</head>
<body>

    <div id="custom-alert">
        <span id="alert-icon">‚ú®</span>
        <span id="alert-text">Action Successful</span>
    </div>

    <div id="confirm-panel" class="modal-overlay hidden" style="z-index: 9999;">
        <div class="modal-content" style="max-width:300px; text-align:center;">
            <p id="confirm-msg" style="margin-bottom:20px; font-weight:700;"></p>
            <div id="confirm-standard-btns" style="display:flex; gap:10px;">
                <button id="confirm-yes" style="flex:1; background:var(--black);">Yes</button>
                <button onclick="closeConfirm()" style="flex:1; background:#e0e0e0; color:#555;">No</button>
            </div>
            <div id="confirm-shipping-btns" class="hidden" style="display:flex; flex-direction:column; gap:10px;">
                <button onclick="confirmCallback('local'); closeConfirm();" style="background:var(--black);">Local (PH)</button>
                <button onclick="confirmCallback('intl'); closeConfirm();" style="background:#444;">International</button>
                <button onclick="closeConfirm()" style="background:none; color:var(--text-light); font-size:0.8rem; box-shadow:none; transform:none;">Cancel</button>
            </div>
        </div>
    </div>

    <div id="invoice-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div id="printable-order-sheet" style="padding: 20px; background: white;">
                <h2 style="text-align:center; margin-bottom:5px; font-family:'Fraunces',serif; font-style:italic;">ORDER SHEET</h2>
                <p id="invoice-date" style="text-align:center; font-size:0.75rem; color:var(--text-light); margin-bottom:20px;"></p>

                <div id="invoice-items-list"></div>

                <hr style="border:none; border-top:2px dashed var(--black); margin:15px 0;">

                <div style="display:flex; justify-content:space-between; font-weight:700; font-size:1.1rem; margin-bottom:10px;">
                    <span>Subtotal:</span>
                    <span id="inv-subtotal" style="background:var(--accent); padding:0 6px;">‚Ç±0.00</span>
                </div>

                <div style="padding:15px; background:var(--bg); border:2px dashed var(--black); text-align:center; color:var(--text-light); font-size:0.75rem; margin-top:10px;">
                    Note: shipping fee will reflect once the order form is submitted.
                </div>
            </div>

            <div id="invoice-actions" style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
                <button onclick="downloadOrderSheet()" style="background:var(--accent); color:var(--black); border:3px solid var(--black); width:100%;">Save Order Sheet</button>
                <button onclick="proceedToCheckout()" style="background:var(--black); width:100%;">Proceed to Check Out</button>
                <button onclick="closeModals()" style="background:#e0e0e0; color:#555; width:100%; box-shadow:none;">Close</button>
            </div>
        </div>
    </div>

    <!-- LOGIN PAGE -->
    <div id="login-page">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
            <div class="admin-card" style="width: 350px; text-align: center; box-shadow: var(--shadow-heavy);">
                <h1 class="logo" style="font-size:1.8rem; margin-bottom: 5px;">RENCE CREATE</h1>
                <p style="font-size: 0.65rem; color: var(--text-light); margin-bottom: 20px; font-style: italic; font-family: 'Fraunces', serif;">
                    Note: No data on this page is being saved or stored.
                </p>
                <input type="text" id="username-input" placeholder="Enter name...">
                <button onclick="enterStore()" style="width: 100%;">Browse Products</button>
            </div>
        </div>
    </div>

    <!-- MAIN PAGE -->
    <div id="main-page" class="hidden">
        <header>
            <div id="welcome-msg" style="font-weight: 900; color: var(--text-light); font-size:0.7rem; letter-spacing:1px;"></div>
            <div class="logo">RENCE CREATE</div>
        </header>
        <div style="max-width: 1200px; margin: auto; padding: 20px;">
            <div class="shop-container">
                <aside class="sidebar" id="main-sidebar"></aside>
                <main class="display-box">
                    <div id="shop-grid" class="product-grid"></div>
                </main>
            </div>
            <div class="cart-footer">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 900; font-size:0.75rem; text-transform:uppercase;">
                    <span>Selected: <span id="cart-qty-total" style="background:var(--accent); padding:0 5px; color:var(--black);">0</span></span>
                    <span>Subtotal: <span style="background:var(--accent); padding:0 5px; color:var(--black);">‚Ç±<span id="cart-subtotal">0.00</span></span></span>
                </div>
                <button onclick="showInvoice()" style="width: 100%; padding: 18px; font-size: 0.85rem;">View Cart üõí</button>
            </div>
        </div>
    </div>

    <!-- ADMIN PAGE -->
    <div id="admin-page" class="hidden" style="max-width: 1100px; margin: auto; padding: 40px;">
        <div class="admin-card">
            <h2 style="margin-top:0; font-family:'Fraunces',serif; font-style:italic;">üõ† Admin Dashboard</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="folder-manager" style="margin-bottom:0;">
                    <h4 style="margin:0 0 10px 0; color: var(--text-light); font-size:0.7rem; letter-spacing:1px;">FOLDER CREATION</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="new-cat-input" placeholder="Folder name..." style="margin:0;">
                        <button onclick="addCategory()">Add</button>
                    </div>
                </div>
                <div class="folder-manager" style="margin-bottom:0;">
                    <h4 style="margin:0 0 10px 0; color: var(--text-light); font-size:0.7rem; letter-spacing:1px;">SHIPPING FEES (‚Ç±)</h4>
                    <div class="shipping-grid" id="admin-shipping-inputs"></div>
                </div>
            </div>
            <div class="shop-container">
                <aside class="sidebar" id="admin-sidebar"></aside>
                <main class="display-box">
                    <table style="width:100%; border-spacing: 0 8px; border-collapse: separate;">
                        <tbody id="admin-list"></tbody>
                    </table>
                </main>
            </div>
            <div style="margin-top: 25px; display: flex; gap: 12px; border-top: 3px solid var(--black); padding-top: 20px;">
                <button onclick="openAdminModal()" style="background: #444;">+ Add Product</button>
                <button onclick="saveAdminChanges()" style="background: var(--success);">Save All Changes</button>
                <button onclick="window.location.reload()" style="background: var(--danger);">Logout</button>
            </div>
        </div>
    </div>

    <!-- ADMIN PRODUCT MODAL -->
    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="modal-header-text" style="margin-top:0;">Product Panel</h2>
            <div id="admin-img-previews" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 12px;"></div>
            <div id="upload-progress-container" class="hidden" style="width: 100%; background: #e0e0e0; height: 8px; margin-bottom: 12px; overflow: hidden; border: 1px solid var(--black);">
                <div id="upload-progress-bar" style="width: 0%; height: 100%; background: var(--accent); transition: 0.3s;"></div>
            </div>
            <div id="upload-status-text" style="font-size: 0.7rem; color: var(--text-light); margin-top: -10px; margin-bottom: 10px;" class="hidden">Processing images...</div>
            <input type="file" id="img-upload" multiple accept="image/*">
            <input type="text" id="p-title" placeholder="Title">
            <textarea id="p-desc" placeholder="Product Description..." style="height:100px;"></textarea>
            <div style="display: flex; gap: 12px;">
                <input type="number" id="p-price" placeholder="Price (‚Ç±)">
                <input type="number" id="p-stock" placeholder="Stock">
            </div>
            <div id="modal-footer" style="display: flex; gap: 10px; margin-top:10px;"></div>
        </div>
    </div>

    <!-- USER PRODUCT VIEW MODAL -->
    <div id="user-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="slider-container">
                <button class="slider-btn-nav" style="left:10px;" onclick="moveSlider(-1)">‚ùÆ</button>
                <div id="slider-wrapper" class="slider-wrapper"></div>
                <button class="slider-btn-nav" style="right:10px;" onclick="moveSlider(1)">‚ùØ</button>
            </div>
            <h2 id="view-title" style="margin: 0 0 5px 0; font-family:'Fraunces',serif; font-style:italic;"></h2>
            <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 15px; font-weight:900; text-transform:uppercase;">Stock: <span id="view-stock-count" style="color: var(--black); background:var(--accent); padding:0 5px;"></span></div>
            <p id="view-desc" style="color: var(--text-light); line-height: 1.6; font-size: 0.85rem; text-align: left;"></p>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 20px; background: var(--bg); padding: 15px; border: 2px solid var(--black);">
                <h3 id="view-price" style="background:var(--accent); padding: 4px 10px; margin: 0; font-family:'Unbounded',sans-serif; font-weight:900;"></h3>
                <div class="qty-controls">
                    <button class="qty-btn" id="qty-minus">-</button>
                    <span id="view-qty-display" style="font-weight: 900; min-width: 20px; text-align: center;">0</span>
                    <button class="qty-btn" id="qty-plus">+</button>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button onclick="closeModals()" style="background: #e0e0e0; color: #555; flex: 1;">Back</button>
                <button id="add-to-cart-btn" style="flex: 2; background:var(--black);">Add To Cart</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="est-tag">EST. 2026<br>BATANGAS. PH</div>
        <div style="text-align:right; font-size:0.65rem; opacity:0.6; line-height:1.8; font-weight: 400;">
            DESIGNED BY RENCE CREATE<br>
            ¬© ALL RIGHTS RESERVED 2026<br>
            AUTHENTIC QUALITY
        </div>
    </footer>

    <script>
        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://wogftjsssxfhktgdfvod.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_9yJg8M-wrRXHMfuDnCtFkA_L3n1Ii36'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- STATE VARIABLES ---
        let categories = { "Stickers": [], "Pins": [] }; 
        let catalog = [];
        let currentCategory = "";
        let currentSubcategory = ""; 
        let adminCurrentCategory = "";
        let tempImages = [];
        let editingIdx = null;
        let tempQty = 0;
        let currentSlide = 0;
        let hasDownloadedSheet = false;

        // --- INITIALIZATION ---
        async function loadAllData() {
            const { data: setts } = await supabaseClient.from('settings').select('*').single();
            if (setts) {
                categories = (setts.category_list && !Array.isArray(setts.category_list)) 
                             ? setts.category_list 
                             : { "Stickers": [], "Pins": [] };
            }
            const { data: prods } = await supabaseClient.from('products').select('*');
            if (prods) {
                catalog = prods.map(p => ({ ...p, cartQty: 0 }));
            }
            const firstCat = Object.keys(categories)[0] || "";
            currentCategory = firstCat;
            adminCurrentCategory = firstCat;
        }

        loadAllData();

        // --- UI HELPERS ---
        function notify(text, icon = "‚ú®") {
            const alertBox = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerText = text;
            document.getElementById('alert-icon').innerText = icon;
            alertBox.classList.add('show');
            setTimeout(() => alertBox.classList.remove('show'), 3000);
        }

        let confirmCallback = null;
        function customConfirm(msg, callback, isShipping = false) {
            document.getElementById('confirm-msg').innerText = msg;
            const standard = document.getElementById('confirm-standard-btns');
            const shipping = document.getElementById('confirm-shipping-btns');
            
            if (isShipping) {
                standard.classList.add('hidden');
                shipping.classList.remove('hidden');
            } else {
                standard.classList.remove('hidden');
                shipping.classList.add('hidden');
            }
            
            document.getElementById('confirm-panel').classList.remove('hidden');
            confirmCallback = callback;
        }
        function closeConfirm() { document.getElementById('confirm-panel').classList.add('hidden'); }
        document.getElementById('confirm-yes').onclick = () => { confirmCallback(); closeConfirm(); };

        async function enterStore() {
            const name = document.getElementById('username-input').value;
            await loadAllData();
            if (name === "051022") { showAdmin(); } 
            else if (name) {
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('main-page').classList.remove('hidden');
                document.getElementById('welcome-msg').innerText = `HELLO, ${name.toUpperCase()}!`;
                renderSidebar('main-sidebar', false);
                renderShop();
                updateCartTotals();
            }
        }

        // --- SIDEBAR & SHOP ---
        function renderSidebar(targetId, isAdmin) {
            const sidebar = document.getElementById(targetId);
            sidebar.innerHTML = '<h3 style="font-size:0.65rem; text-transform:uppercase; color:var(--text-light); margin-bottom:10px; font-family:Unbounded,sans-serif; letter-spacing:2px;">Menu</h3>';
            const scrollDiv = document.createElement('div');
            scrollDiv.className = 'sidebar-scroll';
            
            Object.keys(categories).forEach((catName) => {
                const btn = document.createElement('button');
                const isActive = isAdmin ? (adminCurrentCategory === catName) : (currentCategory === catName);
                btn.className = `sidebar-btn ${isActive ? 'active' : ''}`;
                btn.innerText = catName;
                btn.onclick = () => {
                    if (isAdmin) { adminCurrentCategory = catName; renderSidebar('admin-sidebar', true); renderAdminTable(); } 
                    else { currentCategory = catName; currentSubcategory = ""; renderSidebar('main-sidebar', false); renderShop(); }
                };
                scrollDiv.appendChild(btn);
            });
            sidebar.appendChild(scrollDiv);
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';

            let subBar = document.getElementById('subcategory-bar');
            if (!subBar) {
                subBar = document.createElement('div');
                subBar.id = 'subcategory-bar';
                subBar.style = "display:flex; gap:10px; overflow-x:auto; padding:10px 0; margin-bottom:15px; white-space:nowrap; -webkit-overflow-scrolling:touch; scrollbar-width:none;";
                grid.parentNode.insertBefore(subBar, grid);
            }

            const subs = categories[currentCategory] || [];
            if (subs.length === 0) { subBar.style.display = 'none'; currentSubcategory = ""; } 
            else {
                subBar.style.display = 'flex'; subBar.innerHTML = '';
                const allBtn = createPill("All", currentSubcategory === "");
                allBtn.onclick = () => { currentSubcategory = ""; renderShop(); };
                subBar.appendChild(allBtn);
                subs.forEach(s => {
                    const btn = createPill(s, currentSubcategory === s);
                    btn.onclick = () => { currentSubcategory = (currentSubcategory === s) ? "" : s; renderShop(); };
                    subBar.appendChild(btn);
                });
            }

            const filtered = catalog.filter(item => {
                const matchesCat = item.category === currentCategory;
                const matchesSub = !currentSubcategory || item.subcategory === currentSubcategory;
                return matchesCat && matchesSub && item.status === 'live';
            });

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding-top:50px;"><h2 style="color:var(--text-light); font-family:Fraunces,serif; font-style:italic;">Work In Progress</h2></div>';
                return;
            }

            filtered.forEach(item => {
                const img = item.images?.[0] ? `<img src="${item.images[0]}" style="width:100%; height:100%; object-fit:cover;">` : "No Image";
                grid.innerHTML += `<div class="product-card" onclick="openUserView(${catalog.indexOf(item)})">
                    <div style="width:100%; aspect-ratio:1/1; border:2px solid var(--black); margin-bottom:12px; display:flex; align-items:center; justify-content:center; overflow:hidden; background:#e8e8e8;">${img}</div>
                    <h4 style="margin:5px 0; font-size:0.85rem; text-transform:uppercase;">${item.name}</h4>
                    <p style="font-weight:900; margin:0; background:var(--accent); display:inline-block; padding:0 5px;">‚Ç±${item.price.toFixed(2)}</p>
                </div>`;
            });
        }

        function createPill(text, active) {
            const b = document.createElement('button');
            b.innerText = text;
            b.className = active ? 'sub-pill active' : 'sub-pill';
            return b;
        }

        // --- ADMIN MANAGEMENT TAB ---
        function showAdmin() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('admin-page').classList.remove('hidden');
            renderSidebar('admin-sidebar', true); 
            renderAdminTable();
            renderCategoryManager();
        }

        function renderCategoryManager() {
            const container = document.getElementById('admin-shipping-inputs');
            container.innerHTML = `
                <div style="background:var(--white); padding:20px; border:2px solid var(--black);">
                    <h3 style="margin-top:0; font-family:Fraunces,serif; font-style:italic;">Folder & Sub-Category Manager</h3>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <input type="text" id="mgr-new-cat" placeholder="New Folder Name..." style="flex:1;">
                        <button onclick="mgrAddFolder()">+ Folder</button>
                    </div>
                    <div id="mgr-list"></div>
                </div>
            `;
            const list = document.getElementById('mgr-list');
            Object.keys(categories).forEach(cat => {
                const div = document.createElement('div');
                div.style = "border-top:2px solid var(--black); padding:15px 0;";
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <strong style="font-size:0.9rem; text-transform:uppercase;">üìÅ ${cat}</strong>
                        <button onclick="mgrDelFolder('${cat}')" style="background:none; color:var(--danger); font-size:0.75rem; padding:5px; box-shadow:none; border:1px solid var(--danger); color:var(--danger);">Delete Folder</button>
                    </div>
                    <div style="display:flex; flex-wrap:wrap; gap:8px; margin-left:20px;" id="mgr-subs-${cat}"></div>
                    <div style="margin-left:20px; margin-top:10px; display:flex; gap:5px;">
                        <input type="text" id="in-sub-${cat}" placeholder="New Sub..." style="font-size:0.75rem; padding:5px;">
                        <button onclick="mgrAddSub('${cat}')" style="font-size:0.75rem; padding:5px 10px;">+ Sub</button>
                    </div>
                `;
                list.appendChild(div);
                const subCon = document.getElementById(`mgr-subs-${cat}`);
                categories[cat].forEach(sub => {
                    subCon.innerHTML += `
                        <span style="background:var(--accent); border:1px solid var(--black); padding:4px 10px; font-size:0.75rem; display:flex; align-items:center; gap:5px; font-family:Unbounded,sans-serif; font-weight:900;">
                            ${sub} <b onclick="mgrDelSub('${cat}','${sub}')" style="cursor:pointer; color:var(--black);">√ó</b>
                        </span>`;
                });
            });
        }

        function mgrAddFolder() {
            const name = document.getElementById('mgr-new-cat').value.trim();
            if (name && !categories[name]) { categories[name] = []; renderCategoryManager(); renderSidebar('admin-sidebar', true); notify("Folder Created"); }
        }

        function mgrDelFolder(cat) {
            customConfirm(`Delete "${cat}" and all its sub-categories?`, () => { delete categories[cat]; renderCategoryManager(); renderSidebar('admin-sidebar', true); notify("Folder Deleted"); });
        }

        function mgrAddSub(cat) {
            const name = document.getElementById(`in-sub-${cat}`).value.trim();
            if (name && !categories[cat].includes(name)) { categories[cat].push(name); renderCategoryManager(); notify("Sub-category Added"); }
        }

        function mgrDelSub(cat, sub) {
            categories[cat] = categories[cat].filter(s => s !== sub);
            renderCategoryManager();
        }

        // --- PRODUCT MANAGEMENT ---
        function renderAdminTable() {
            const list = document.getElementById('admin-list'); 
            list.innerHTML = '';
            catalog.forEach((item, i) => {
                if (item.category === adminCurrentCategory) {
                    const isLive = item.status === 'live';
                    list.innerHTML += `
                        <tr id="row-${i}" class="admin-mobile-row">
                            <td>
                                <div style="font-weight:900; font-size:0.8rem; text-transform:uppercase;">${item.name}</div>
                                <div style="font-size:0.65rem; color:var(--text-light);">${item.subcategory || 'No Subcategory'}</div>
                            </td>
                            <td style="font-weight:bold; font-size:0.85rem;"><span style="background:var(--accent); padding:2px 6px;">‚Ç±${item.price.toFixed(2)}</span></td>
                            <td><button onclick="toggleLiveStatus(${i})" style="background:${isLive ? 'var(--accent)' : '#e0e0e0'}; color:${isLive ? 'var(--black)' : '#888'};">${isLive ? 'LIVE' : 'OFF'}</button></td>
                            <td><button onclick="openAdminModal(${i})">Edit</button></td>
                        </tr>`;
                }
            });
        }

        function openAdminModal(idx = null) {
            editingIdx = idx;
            tempImages = idx !== null ? [...(catalog[idx].images || [])] : [];
            document.getElementById('p-title').value = idx !== null ? catalog[idx].name : "";
            document.getElementById('p-desc').value = idx !== null ? catalog[idx].description : "";
            document.getElementById('p-price').value = idx !== null ? catalog[idx].price : "";
            document.getElementById('p-stock').value = idx !== null ? catalog[idx].stock : "";

            const titleInput = document.getElementById('p-title');
            document.querySelectorAll('.dynamic-cat-field').forEach(el => el.remove());

            const catSelect = document.createElement('select');
            catSelect.id = 'p-category';
            catSelect.className = 'dynamic-cat-field';
            catSelect.onchange = () => updateSubcatDropdown();
            Object.keys(categories).forEach(cat => {
                const opt = document.createElement('option');
                opt.value = opt.innerText = cat;
                if (idx !== null && catalog[idx].category === cat) opt.selected = true;
                catSelect.appendChild(opt);
            });

            const subSelect = document.createElement('select');
            subSelect.id = 'p-subcategory';
            subSelect.className = 'dynamic-cat-field';

            titleInput.after(catSelect, subSelect);
            updateSubcatDropdown(idx !== null ? catalog[idx].subcategory : "");

            renderAdminImgPreviews();
            document.getElementById('admin-modal').classList.remove('hidden');
        }

        function updateSubcatDropdown(selectedSub = "") {
            const cat = document.getElementById('p-category').value;
            const subSelect = document.getElementById('p-subcategory');
            subSelect.innerHTML = '<option value="">(No Subcategory)</option>';
            if (categories[cat]) {
                categories[cat].forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = opt.innerText = sub;
                    if(sub === selectedSub) opt.selected = true;
                    subSelect.appendChild(opt);
                });
            }
        }

        async function saveProduct() {
            const name = document.getElementById('p-title').value;
            if (!name) return notify("Name is required!", "‚ö†Ô∏è");
            const data = {
                name: name,
                description: document.getElementById('p-desc').value,
                price: parseFloat(document.getElementById('p-price').value) || 0,
                stock: parseInt(document.getElementById('p-stock').value) || 0,
                images: tempImages,
                category: document.getElementById('p-category').value,
                subcategory: document.getElementById('p-subcategory').value,
                status: editingIdx !== null ? catalog[editingIdx].status : 'offline'
            };
            if (editingIdx !== null) catalog[editingIdx] = { ...catalog[editingIdx], ...data };
            else catalog.push({ ...data, id: Date.now(), cartQty: 0 });
            closeModals(); renderAdminTable(); await syncItemToCloud(editingIdx === null ? catalog.length-1 : editingIdx);
        }

        async function syncItemToCloud(idx) {
            try {
                const { cartQty, ...cleanData } = catalog[idx];
                await supabaseClient.from('products').upsert(cleanData);
                notify("Cloud Updated!", "‚òÅÔ∏è");
            } catch (err) { notify("Sync Failed", "‚ùå"); }
        }

        async function saveAdminChanges() {
            const btn = event.target;
            btn.innerText = "‚è≥ Saving...";
            await supabaseClient.from('settings').upsert({ id: 1, category_list: categories });
            notify("Settings Saved!", "üíæ");
            btn.innerText = "Save All Changes";
        }

        // --- CART & INVOICE ---
        function updateCartTotals() {
            let count = 0, sub = 0;
            catalog.forEach(item => { if(item.cartQty > 0) { count += item.cartQty; sub += (item.cartQty * item.price); } });
            document.getElementById('cart-qty-total').innerText = count;
            document.getElementById('cart-subtotal').innerText = sub.toFixed(2);
        }

        function showInvoice() {
            hasDownloadedSheet = false;
            const listCon = document.getElementById('invoice-items-list');
            if (!listCon) return;
            
            listCon.innerHTML = '';
            let subtotal = 0;
            let hasItems = false;
        
            document.getElementById('invoice-date').innerText = new Date().toLocaleString();
        
            catalog.forEach((item, index) => {
                if (item.cartQty > 0) {
                    hasItems = true;
                    const itemTotal = item.cartQty * item.price;
                    subtotal += itemTotal;
                    listCon.innerHTML += `
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8rem;">
                            <div style="flex:1;">
                                <span style="font-weight:900; text-transform:uppercase;">${item.name}</span><br>
                                <small style="color:var(--text-light);">‚Ç±${item.price.toFixed(2)} x ${item.cartQty}</small>
                            </div>
                            <div style="font-weight:900; background:var(--accent); padding:0 5px; align-self:flex-start;">‚Ç±${itemTotal.toFixed(2)}</div>
                        </div>`;
                }
            });
        
            if (!hasItems) {
                notify("Your cart is empty!", "üõí");
                return;
            }
        
            document.getElementById('inv-subtotal').innerText = `‚Ç±${subtotal.toFixed(2)}`;
            document.getElementById('invoice-modal').classList.remove('hidden');
        }

        function downloadOrderSheet() {
            const sheet = document.getElementById('printable-order-sheet');
            html2canvas(sheet).then(canvas => {
                const link = document.createElement('a');
                link.download = `order-${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                hasDownloadedSheet = true;
                notify("Order Sheet Saved!");
            });
        }
        
        function proceedToCheckout() {
            if (!hasDownloadedSheet) {
                notify("Please download the order sheet.", "‚ö†Ô∏è");
                return;
            }
        
            customConfirm("Where are you ordering from?", (choice) => {
                const localURL = "https://docs.google.com/forms/d/e/1FAIpQLSdLMu09mL10Gh6BGKQaY3Oa0iJnw2esAbpeVw_d7nrrhnZu2Q/viewform?usp=sharing&ouid=101835408618855772238";
                const intlURL = "https://docs.google.com/forms/d/e/1FAIpQLSfQ4-Po8E5xW_XyYnB9yFE53qYucCIGBmwzHZTpyKBOVWFHkA/viewform?usp=sharing&ouid=101835408618855772238";
                
                if (choice === 'local') {
                    window.open(localURL, '_blank');
                } else {
                    window.open(intlURL, '_blank');
                }
            }, true);
        }

        function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden')); }

        function renderAdminImgPreviews() {
            const con = document.getElementById('admin-img-previews');
            con.innerHTML = '';
            for(let i=0; i<5; i++) {
                const div = document.createElement('div');
                div.style = "aspect-ratio:1/1; background:var(--bg); border:2px solid var(--black); display:flex; align-items:center; justify-content:center; font-size:10px; overflow:hidden; font-family:Unbounded,sans-serif;";
                div.innerHTML = tempImages[i] ? `<img src="${tempImages[i]}" style="width:100%; height:100%; object-fit:cover;">` : "Empty";
                con.appendChild(div);
            }
        }

        function openUserView(idx) {
            const item = catalog[idx];
            tempQty = 0; 
            currentSlide = 0;

            document.getElementById('view-title').innerText = item.name;
            document.getElementById('view-desc').innerText = item.description || "";
            document.getElementById('view-price').innerText = `‚Ç±${item.price.toFixed(2)}`;
            document.getElementById('view-stock-count').innerText = item.stock;

            const wrap = document.getElementById('slider-wrapper'); 
            wrap.innerHTML = '';
            if (item.images?.length > 0) {
                item.images.forEach(img => {
                    wrap.innerHTML += `<img src="${img}" style="width:100%; height:100%; object-fit:cover; flex-shrink:0;">`;
                });
            }
            wrap.style.transform = `translateX(0px)`;

            document.getElementById('qty-plus').onclick = () => {
                if (tempQty < item.stock) {
                    tempQty++;
                    updateQtyDisplay(item);
                } else {
                    notify("Reached maximum stock", "‚ö†Ô∏è");
                }
            };

            document.getElementById('qty-minus').onclick = () => {
                if (tempQty > 0) {
                    tempQty--;
                    updateQtyDisplay(item);
                }
            };

            document.getElementById('add-to-cart-btn').onclick = () => {
                if (tempQty > 0) {
                    item.cartQty = (item.cartQty || 0) + tempQty;
                    updateCartTotals();
                    notify("Added to cart!", "üõí");
                    closeModals();
                } else {
                    notify("Please add quantity", "‚òùÔ∏è");
                }
            };

            updateQtyDisplay(item);
            document.getElementById('user-modal').classList.remove('hidden');
        }

        function updateQtyDisplay(item) {
            const display = document.getElementById('view-qty-display');
            const plusBtn = document.getElementById('qty-plus');
            const minusBtn = document.getElementById('qty-minus');

            if (display) display.innerText = tempQty;
            
            if (minusBtn) minusBtn.style.opacity = tempQty <= 0 ? "0.3" : "1";
            if (plusBtn) plusBtn.style.opacity = tempQty >= item.stock ? "0.3" : "1";
        }

        function moveSlider(dir) {
            const wrap = document.getElementById('slider-wrapper');
            const imgs = wrap.querySelectorAll('img');
            if (imgs.length === 0) return;
            currentSlide = (currentSlide + dir + imgs.length) % imgs.length;
            wrap.style.transform = `translateX(-${currentSlide * 100}%)`;
        }

        function toggleLiveStatus(idx) {
            catalog[idx].status = catalog[idx].status === 'live' ? 'offline' : 'live';
            renderAdminTable();
            syncItemToCloud(idx);
        }

        function addCategory() {
            const input = document.getElementById('new-cat-input');
            const name = input.value.trim();
            if (name && !categories[name]) {
                categories[name] = [];
                input.value = '';
                renderSidebar('admin-sidebar', true);
                notify("Category Added!");
            }
        }

        // Admin modal footer buttons
        const adminModalFooter = document.getElementById('modal-footer');
        if (adminModalFooter) {
            adminModalFooter.innerHTML = `
                <button onclick="saveProduct()" style="flex:2; background:var(--black);">Save Product</button>
                <button onclick="closeModals()" style="flex:1; background:#e0e0e0; color:#555;">Cancel</button>
            `;
        }

        // Image upload handler
        document.getElementById('img-upload').addEventListener('change', async function() {
            const files = Array.from(this.files);
            if (!files.length) return;
            
            const progressCon = document.getElementById('upload-progress-container');
            const progressBar = document.getElementById('upload-progress-bar');
            const statusText = document.getElementById('upload-status-text');
            
            progressCon.classList.remove('hidden');
            statusText.classList.remove('hidden');
            tempImages = [];
            
            for (let i = 0; i < Math.min(files.length, 5); i++) {
                const file = files[i];
                const reader = new FileReader();
                await new Promise(resolve => {
                    reader.onload = e => {
                        tempImages.push(e.target.result);
                        const pct = ((i + 1) / Math.min(files.length, 5)) * 100;
                        progressBar.style.width = pct + '%';
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            progressCon.classList.add('hidden');
            statusText.classList.add('hidden');
            renderAdminImgPreviews();
            notify("Images loaded!", "üñºÔ∏è");
        });
    </script>
</body>
</html>
