<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RENCE CREATE | Art Shop</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Fraunces:ital,opsz,wght@0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">

    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ROOT VARIABLES
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --bg:            #f4f4f4;
            --black:         #000000;
            --accent:        #00ff66;
            --white:         #ffffff;
            --grey:          #e0e0e0;
            --text-muted:    #555555;
            --border:        3px solid var(--black);
            --shadow-sm:     6px 6px 0px var(--black);
            --shadow-lg:     12px 12px 0px var(--black);
            --shadow-accent: 8px 8px 0px var(--accent);
            --ease:          cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition:    all 0.25s var(--ease);

            /* Aliases kept for JS-generated inline styles */
            --primary:       var(--black);
            --text:          var(--black);
            --text-light:    var(--text-muted);
            --danger:        #e00000;
            --success:       var(--accent);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           RESET & BASE
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Unbounded', sans-serif;
            background: var(--bg);
            color: var(--black);
            overflow-x: hidden;
            line-height: 1.5;
        }

        .hidden { display: none !important; }

        h1, h2, h3, .serif {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-weight: 400;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           FIXED GLASSMORPHISM HEADER  (headroom logic)
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            position: fixed;
            top: 16px;
            left: 16px;
            right: 16px;
            z-index: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 28px;
            background: rgba(255,255,255,0.72);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: var(--border);
            box-shadow: var(--shadow-sm);
            /* Headroom: smooth hide/reveal */
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            will-change: transform, opacity;
        }

        /* Hidden state â€” fully above viewport, non-interactive */
        header.headroom--hidden {
            transform: translateY(calc(-100% - 32px));
            opacity: 0;
            pointer-events: none;
        }

        /* Push all page content below the fixed header */
        body { padding-top: 80px; }

        .logo {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 1.3rem;
            letter-spacing: -1.5px;
            color: var(--black);
            text-decoration: none;
        }

        .header-right { display: flex; align-items: center; gap: 20px; }

        #welcome-msg {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        .cart-btn {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .cart-btn:hover {
            background: var(--accent);
            color: var(--black);
            transform: translateY(-3px);
            box-shadow: 4px 4px 0px var(--black);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           LOGIN PAGE
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: var(--white);
            border: var(--border);
            box-shadow: var(--shadow-accent);
            padding: 48px 40px;
            width: 360px;
            text-align: center;
        }

        .login-card .logo { font-size: 1.6rem; display: block; margin-bottom: 8px; }
        .login-card .tagline {
            font-family: 'Fraunces', serif;
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 32px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           SHOP CLOSED OVERLAY
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #shop-closed-overlay {
            position: fixed;
            inset: 0;
            z-index: 8000;
            background: var(--black);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 24px;
        }

        #shop-closed-overlay .closed-label {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-weight: 700;
            font-size: clamp(3rem, 12vw, 8rem);
            color: var(--white);
            line-height: 1;
            margin-bottom: 24px;
            /* Subtle accent underline */
            border-bottom: 6px solid var(--accent);
            padding-bottom: 16px;
        }

        #shop-closed-overlay .closed-msg {
            font-family: 'Unbounded', sans-serif;
            font-size: clamp(0.65rem, 2vw, 0.85rem);
            font-weight: 400;
            color: rgba(255,255,255,0.6);
            max-width: 480px;
            line-height: 1.8;
            letter-spacing: 0.5px;
        }

        #shop-closed-overlay .closed-accent-line {
            width: 60px;
            height: 4px;
            background: var(--accent);
            margin: 28px auto 0;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           INPUTS & BUTTONS (global)
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        input, textarea, select {
            width: 100%;
            padding: 11px 14px;
            border: 2px solid var(--black);
            border-radius: 0;
            background: var(--white);
            font-family: 'Unbounded', sans-serif;
            font-size: 0.7rem;
            color: var(--black);
            margin-bottom: 10px;
            transition: box-shadow 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 4px 4px 0px var(--accent);
        }

        button {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--black);
            color: var(--white);
            border: none;
            padding: 12px 22px;
            cursor: pointer;
            transition: var(--transition);
        }

        button:hover {
            background: var(--accent);
            color: var(--black);
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px var(--black);
        }

        button.btn-ghost {
            background: var(--grey);
            color: #444;
        }

        button.btn-ghost:hover {
            background: var(--grey);
            color: var(--black);
            box-shadow: 3px 3px 0px var(--black);
        }

        button.btn-danger  { background: var(--danger); color: var(--white); }
        button.btn-success { background: var(--accent);  color: var(--black); border: 2px solid var(--black); }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           MAIN SHOP PAGE â€” NEW UI LAYOUT
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #main-page { padding-bottom: 100px; } /* ensures last grid row + footer clear the fixed cart bar */

        /* Category / Folder Nav */
        .category-section {
            max-width: 1300px;
            margin: 0 auto;
            padding: 56px 24px 24px;
            text-align: center;
        }

        .folder-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 32px;
            margin-bottom: 28px;
        }

        .folder-link {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            position: relative;
            padding-bottom: 6px;
            transition: var(--transition);
            user-select: none;
        }

        .folder-link::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0;
            width: 0; height: 4px;
            background: var(--accent);
            transition: width 0.3s var(--ease);
        }

        .folder-link:hover::after,
        .folder-link.active::after { width: 100%; }

        /* Sub-category pill bar */
        .sub-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 36px;
        }

        .sub-pill {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 7px 20px;
            border: 2px solid var(--black);
            border-radius: 50px;
            background: transparent;
            color: var(--black);
            cursor: pointer;
            transition: var(--transition);
        }

        .sub-pill:hover,
        .sub-pill.active {
            background: var(--black);
            color: var(--white);
            transform: scale(1.06);
            box-shadow: none;
        }

        /* Art Grid */
        .shop-container-new {
            max-width: 1300px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .art-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 36px;
        }

        .art-card {
            border: var(--border);
            background: var(--white);
            padding: 14px;
            cursor: pointer;
            transition: transform 0.25s var(--ease), box-shadow 0.25s var(--ease);
        }

        .art-card:hover {
            transform: translate(-8px, -8px);
            box-shadow: var(--shadow-lg);
        }

        .img-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            border: 2px solid var(--black);
            background: #e4e4e4;
            overflow: hidden;
            position: relative;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .art-card:hover .img-container img { transform: scale(1.08); }

        .img-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: var(--text-muted);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-details {
            margin-top: 14px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 10px;
        }

        .card-details .card-info small {
            display: block;
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .card-details .card-info h4 {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.85rem;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .price-tag {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 1rem;
            background: var(--accent);
            color: var(--black);
            padding: 2px 8px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* Empty state */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state h2 {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-size: 2.5rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           STICKY CART BAR
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .cart-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 400;
            background: var(--white);
            border-top: var(--border);
            box-shadow: 0 -4px 0px var(--black);
            padding: 14px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .cart-bar-info {
            display: flex;
            gap: 24px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cart-bar-info span b {
            background: var(--accent);
            padding: 1px 7px;
            color: var(--black);
            font-weight: 900;
        }

        .cart-bar button {
            padding: 14px 32px;
            font-size: 0.75rem;
            flex-shrink: 0;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           MODAL OVERLAY
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.87);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        #confirm-panel { z-index: 3000 !important; }

        /* Shared card wrapper for modals */
        .modal-card {
            background: var(--white);
            border: var(--border);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
            box-shadow: var(--shadow-accent);
            position: relative;
        }

        .modal-card.narrow { max-width: 340px; text-align: center; }

        .checkout-card {
            background: var(--white);
            border: var(--border);
            width: 100%;
            max-width: 460px;
            padding: 32px;
            box-shadow: 14px 14px 0px var(--accent);
            position: relative;
        }

        /* Invoice / order sheet */
        .invoice-paper {
            border: 2px dashed var(--black);
            padding: 20px;
            margin: 20px 0;
            background: #fafafa;
        }

        .invoice-paper .invoice-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            font-size: 0.78rem;
            margin-bottom: 10px;
        }

        .invoice-paper .invoice-row .item-name { font-weight: 900; text-transform: uppercase; }
        .invoice-paper .invoice-row .item-qty  { font-size: 0.65rem; color: var(--text-muted); }
        .invoice-paper .invoice-row .item-price { font-weight: 900; }

        .invoice-divider { border: none; border-top: 2px dashed var(--black); margin: 14px 0; }

        .invoice-total {
            display: flex;
            justify-content: space-between;
            font-weight: 900;
            font-size: 1rem;
        }

        .invoice-total .total-amount { background: var(--accent); padding: 2px 10px; }

        /* Checkout action buttons */
        .btn-action {
            display: block;
            width: 100%;
            padding: 16px;
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.75rem;
            text-transform: uppercase;
            background: var(--black);
            color: var(--white);
            border: none;
            cursor: pointer;
            margin-top: 10px;
            transition: var(--transition);
        }

        .btn-action:hover {
            transform: translate(-3px, -3px);
            box-shadow: 5px 5px 0px var(--accent);
            background: var(--black);
            color: var(--white);
        }

        .btn-download {
            background: var(--accent);
            color: var(--black);
            border: 2px solid var(--black);
        }

        .btn-download:hover {
            background: var(--accent);
            color: var(--black);
            box-shadow: 5px 5px 0px var(--black);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           USER PRODUCT VIEW MODAL â€” 16:9 Thumbnail Slider
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .slider-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;   /* YouTube / Roblox game preview thumbnail */
            border: 2px solid var(--black);
            background: var(--bg);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .slider-wrapper { display: flex; height: 100%; transition: transform 0.35s ease; }
        .slider-wrapper img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; }

        .slider-btn-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.9);
            border: 2px solid var(--black);
            width: 36px; height: 36px;
            font-size: 0.9rem;
            font-weight: 900;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .slider-btn-nav:hover {
            background: var(--accent);
            transform: translateY(-50%) translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--black);
        }

        .modal-price-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg);
            border: 2px solid var(--black);
            padding: 14px 18px;
            margin-top: 20px;
        }

        .modal-price {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 1.3rem;
            background: var(--accent);
            padding: 2px 10px;
        }

        .qty-controls { display: flex; align-items: center; gap: 14px; }

        .qty-btn {
            width: 36px; height: 36px;
            background: var(--accent);
            color: var(--black);
            border: 2px solid var(--black);
            font-size: 1.1rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
            transition: var(--transition);
        }

        .qty-btn:hover {
            background: var(--black);
            color: var(--accent);
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--accent);
        }

        #view-qty-display {
            font-weight: 900;
            font-size: 1.1rem;
            min-width: 24px;
            text-align: center;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           TOAST NOTIFICATION
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #custom-alert {
            position: fixed;
            bottom: 88px; /* above cart bar */
            right: 24px;
            background: var(--black);
            color: var(--white);
            padding: 14px 22px;
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            /* Hidden by default â€” fully off-screen AND non-interactive */
            transform: translateY(calc(100% + 140px));
            opacity: 0;
            pointer-events: none;
            transition: transform 0.45s var(--ease), opacity 0.45s ease;
            z-index: 9999;
            box-shadow: 5px 5px 0px var(--accent);
            max-width: 320px;
        }

        /* Visible state */
        #custom-alert.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ADMIN DASHBOARD
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #admin-page {
            max-width: 1140px;
            margin: 40px auto;
            padding: 0 24px 80px;
        }

        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: var(--border);
        }

        .admin-header h2 {
            font-family: 'Fraunces', serif;
            font-style: italic;
            font-size: 2rem;
        }

        .admin-header-actions { display: flex; gap: 10px; }

        /* Admin top controls grid */
        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 28px;
        }

        .admin-panel {
            background: var(--white);
            border: var(--border);
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }

        .admin-panel h4 {
            font-size: 0.6rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            margin-bottom: 14px;
        }

        /* Shop Status toggle in admin */
        .shop-status-panel {
            background: var(--white);
            border: var(--border);
            padding: 20px 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 24px;
            flex-wrap: wrap;
        }

        .shop-status-panel .status-label {
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .toggle-track {
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: var(--grey);
            border: 2px solid var(--black);
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--black);
            transition: transform 0.2s ease;
        }

        .toggle-switch.on {
            background: var(--accent);
        }

        .toggle-switch.on::after {
            transform: translateX(28px);
        }

        .toggle-status-text {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .toggle-status-text.open  { color: var(--accent); }
        .toggle-status-text.closed { color: var(--danger); }

        /* Admin shop area: sidebar + table */
        .admin-shop-area {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        /* Admin sidebar (folders) */
        .admin-sidebar {
            width: 200px;
            flex-shrink: 0;
            border: var(--border);
            background: var(--white);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .admin-sidebar-title {
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            padding: 14px 16px 10px;
            border-bottom: 2px solid var(--black);
        }

        .admin-folder-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--grey);
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--black);
            cursor: pointer;
            transition: background 0.15s;
        }

        .admin-folder-btn:hover {
            background: var(--bg);
            transform: none;
            box-shadow: none;
            color: var(--black);
        }

        .admin-folder-btn.active {
            background: var(--black);
            color: var(--accent);
            box-shadow: none;
            transform: none;
        }

        /* Admin product table */
        .admin-table-wrap {
            flex: 1;
            border: var(--border);
            background: var(--white);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table thead tr {
            background: var(--black);
            color: var(--white);
        }

        .admin-table thead th {
            text-align: left;
            font-size: 0.55rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 12px 16px;
        }

        .admin-table tbody tr {
            border-bottom: 1px solid var(--grey);
            transition: background 0.15s;
        }

        .admin-table tbody tr:hover { background: var(--bg); }

        .admin-table td {
            padding: 12px 16px;
            font-size: 0.7rem;
            vertical-align: middle;
        }

        .admin-table .prod-name { font-weight: 900; text-transform: uppercase; }
        .admin-table .prod-sub  { font-size: 0.6rem; color: var(--text-muted); margin-top: 2px; }

        .badge-live {
            background: var(--accent);
            color: var(--black);
            border: 2px solid var(--black);
            padding: 4px 12px;
            font-size: 0.6rem;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--transition);
        }

        .badge-off {
            background: var(--grey);
            color: #777;
            border: 2px solid #bbb;
            padding: 4px 12px;
            font-size: 0.6rem;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            transition: var(--transition);
        }

        .badge-live:hover, .badge-off:hover {
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--black);
        }

        .admin-edit-btn {
            background: transparent;
            border: 2px solid var(--black);
            color: var(--black);
            padding: 5px 14px;
            font-size: 0.6rem;
        }

        .admin-edit-btn:hover {
            background: var(--black);
            color: var(--accent);
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0px var(--accent);
        }

        .admin-table-empty {
            padding: 48px;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
            font-style: italic;
            font-family: 'Fraunces', serif;
        }

        /* Category Manager (in modal) */
        .cat-manager-item {
            border-top: 2px solid var(--grey);
            padding: 16px 0;
        }

        .cat-manager-item:first-child { border-top: none; }

        .cat-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .cat-folder-name {
            font-size: 0.75rem;
            font-weight: 900;
            text-transform: uppercase;
        }

        .btn-del-folder {
            background: none;
            border: 1px solid var(--danger);
            color: var(--danger);
            font-size: 0.6rem;
            padding: 4px 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-del-folder:hover {
            background: var(--danger);
            color: var(--white);
            transform: translate(-2px,-2px);
            box-shadow: 3px 3px 0px var(--black);
        }

        .sub-tags-wrap {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-left: 16px;
            margin-bottom: 10px;
        }

        .sub-tag {
            background: var(--accent);
            border: 1px solid var(--black);
            padding: 4px 10px;
            font-size: 0.6rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sub-tag-del {
            cursor: pointer;
            font-weight: 900;
            color: var(--black);
            line-height: 1;
        }

        .sub-add-row {
            display: flex;
            gap: 8px;
            margin-left: 16px;
        }

        .sub-add-row input {
            font-size: 0.65rem;
            padding: 7px 10px;
            margin: 0;
            flex: 1;
        }

        .sub-add-row button {
            font-size: 0.6rem;
            padding: 7px 14px;
            flex-shrink: 0;
        }

        /* Admin modal product form */
        #admin-img-previews {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 14px;
        }

        .img-preview-slot {
            aspect-ratio: 1;
            background: var(--bg);
            border: 2px solid var(--black);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            overflow: hidden;
        }

        .img-preview-slot img { width: 100%; height: 100%; object-fit: cover; }

        #upload-progress-wrap {
            height: 6px;
            background: var(--grey);
            border: 1px solid var(--black);
            margin-bottom: 12px;
            overflow: hidden;
        }

        #upload-progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Admin modal footer */
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions button { flex: 1; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           FOOTER
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        footer {
            background: var(--black);
            color: var(--white);
            padding: 56px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 60px;
            /* Push footer content above the fixed 72px cart bar with extra breathing room */
            margin-bottom: 80px;
        }

        .est-tag {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: clamp(1rem, 4vw, 1.5rem);
            line-height: 1.3;
        }

        .footer-copy {
            text-align: right;
            font-size: 0.6rem;
            opacity: 0.5;
            line-height: 2;
            font-weight: 400;
            letter-spacing: 1px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           RESPONSIVE
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            header {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 10px 16px;
                flex-wrap: wrap;
                gap: 8px;
            }

            body { padding-top: 72px; }

            #welcome-msg { font-size: 0.55rem; }
            .logo { font-size: 1.1rem; }

            .category-section { padding: 44px 16px 16px; }

            .folder-nav { gap: 18px; }
            .folder-link { font-size: 0.8rem; }

            .art-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .shop-container-new { padding: 24px 16px; }

            .card-details { flex-direction: column; align-items: flex-start; gap: 8px; }

            .cart-bar { padding: 12px 16px; flex-direction: column; gap: 10px; }
            .cart-bar-info { gap: 16px; justify-content: center; }
            .cart-bar button { width: 100%; }

            /* Admin mobile */
            #admin-page { padding: 0 12px 80px; margin-top: 20px; }

            .admin-controls { grid-template-columns: 1fr; }

            .admin-shop-area { flex-direction: column; }
            .admin-sidebar { width: 100%; }

            .admin-sidebar-buttons { display: flex; overflow-x: auto; gap: 0; }
            .admin-folder-btn { white-space: nowrap; border-right: 1px solid var(--grey); border-bottom: none; }

            .admin-table { font-size: 0.65rem; }
            .admin-table thead { display: none; }
            .admin-table tbody tr {
                display: block;
                border: 2px solid var(--black);
                margin-bottom: 12px;
                padding: 12px;
                background: var(--white);
            }
            .admin-table td {
                display: block;
                padding: 4px 0;
                border: none;
                text-align: left !important;
            }

            .modal-card, .checkout-card {
                padding: 20px 18px;
                max-width: 100%;
            }

            .slider-container { aspect-ratio: 4/3; }

            footer { padding: 40px 24px; }
            .footer-copy { text-align: left; }

            #custom-alert { bottom: 150px; right: 12px; left: 12px; max-width: none; }
        }

        @media (max-width: 480px) {
            .art-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
            .folder-link { font-size: 0.7rem; }
        }
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GLOBAL UI: TOAST + CONFIRM DIALOG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="custom-alert">
    <span id="alert-icon">âœ¨</span>
    <span id="alert-text">Action Successful</span>
</div>

<div id="confirm-panel" class="modal-overlay hidden">
    <div class="modal-card narrow">
        <p id="confirm-msg" style="font-size:0.85rem; font-weight:700; margin-bottom:24px; line-height:1.5;"></p>
        <div id="confirm-standard-btns" style="display:flex; gap:10px;">
            <button id="confirm-yes" style="flex:1;">Yes</button>
            <button onclick="closeConfirm()" class="btn-ghost" style="flex:1;">No</button>
        </div>
        <div id="confirm-shipping-btns" class="hidden" style="display:flex; flex-direction:column; gap:10px;">
            <button onclick="confirmCallback('local'); closeConfirm();">ğŸ“¦ Local (PH)</button>
            <button onclick="confirmCallback('intl'); closeConfirm();" style="background:#333;">âœˆï¸ International</button>
            <button onclick="closeConfirm()" class="btn-ghost" style="margin-top:4px;">Cancel</button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     INVOICE MODAL  (VIEW INVOICE â€” clean printable sheet)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="invoice-modal" class="modal-overlay hidden">
    <div class="checkout-card">
        <h2 class="serif" style="font-size:2rem; margin-bottom:4px;">Your Bag</h2>
        <p style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-bottom:0;">Review before downloading</p>

        <div class="invoice-paper" id="printable-order-sheet">
            <div style="text-align:center; margin-bottom:16px;">
                <strong style="font-family:'Unbounded',sans-serif; font-size:0.75rem; letter-spacing:2px;">ORDER SHEET</strong>
                <p id="invoice-date" style="font-size:0.6rem; color:var(--text-muted); margin-top:4px;"></p>
            </div>
            <div id="invoice-items-list"></div>
            <hr class="invoice-divider">
            <div class="invoice-total">
                <span style="font-size:0.8rem;">SUBTOTAL</span>
                <span id="inv-subtotal" class="total-amount">â‚±0.00</span>
            </div>
            <p style="font-size:0.6rem; color:var(--text-muted); margin-top:14px; text-align:center; font-style:italic;">
                Shipping fee reflected after order form submission.
            </p>
        </div>

        <button class="btn-action btn-download" onclick="downloadOrderSheet()">1. Download Order Sheet</button>
        <button class="btn-action" onclick="proceedToCheckout()">2. Proceed to Checkout â†’</button>
        <button onclick="closeModals()" style="background:none; border:none; width:100%; margin-top:14px; cursor:pointer; font-size:0.6rem; font-weight:900; text-decoration:underline; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; transform:none; box-shadow:none;">Go Back</button>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EDIT ORDER MODAL  (header "EDIT ORDER" button)
     â€” live quantity editing + remove items
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="edit-order-modal" class="modal-overlay hidden">
    <div class="modal-card" style="max-width:480px;">
        <h2 class="serif" style="font-size:1.8rem; margin-bottom:4px;">Edit Order</h2>
        <p style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-bottom:20px;">Adjust quantities or remove items</p>

        <div id="edit-order-list" style="display:flex; flex-direction:column; gap:14px;"></div>

        <div id="edit-order-empty" class="hidden" style="text-align:center; padding:40px 0; font-family:'Fraunces',serif; font-style:italic; color:var(--text-muted); font-size:1.2rem;">
            Your cart is empty.
        </div>

        <!-- Running total -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-top: var(--border); margin-top:20px; padding-top:16px;">
            <span style="font-size:0.65rem; font-weight:900; text-transform:uppercase; letter-spacing:1px;">Running Total</span>
            <span id="edit-order-total" style="font-weight:900; font-size:1.1rem; background:var(--accent); padding:2px 12px;">â‚±0.00</span>
        </div>

        <div style="display:flex; gap:10px; margin-top:16px;">
            <button onclick="closeModals()" class="btn-ghost" style="flex:1;">â† Back</button>
            <button onclick="closeModals(); showInvoice();" style="flex:2;">View Invoice ğŸ§¾</button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     USER PRODUCT VIEW MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="user-modal" class="modal-overlay hidden">
    <div class="modal-card">
        <div class="slider-container">
            <button class="slider-btn-nav" style="left:10px;" onclick="moveSlider(-1)">â®</button>
            <div id="slider-wrapper" class="slider-wrapper"></div>
            <button class="slider-btn-nav" style="right:10px;" onclick="moveSlider(1)">â¯</button>
        </div>

        <h2 id="view-title" style="font-family:'Fraunces',serif; font-style:italic; font-size:1.6rem; margin-bottom:4px;"></h2>
        <p style="font-size:0.6rem; font-weight:700; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-muted);">
            Stock available: <b id="view-stock-count" style="background:var(--accent); color:var(--black); padding:0 5px;"></b>
        </p>

        <p id="view-desc" style="font-size:0.78rem; color:var(--text-muted); line-height:1.7; margin-top:12px;"></p>

        <div class="modal-price-row">
            <span class="modal-price" id="view-price"></span>
            <div class="qty-controls">
                <button class="qty-btn" id="qty-minus">âˆ’</button>
                <span id="view-qty-display">0</span>
                <button class="qty-btn" id="qty-plus">+</button>
            </div>
        </div>

        <div class="modal-actions" style="margin-top:20px;">
            <button onclick="closeModals()" class="btn-ghost" style="flex:1;">â† Back</button>
            <button id="add-to-cart-btn" style="flex:2;">Add to Cart ğŸ›’</button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN PRODUCT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-modal" class="modal-overlay hidden">
    <div class="modal-card">
        <h2 id="modal-header-text" style="font-family:'Fraunces',serif; font-style:italic; margin-bottom:20px;">Product Panel</h2>

        <div id="admin-img-previews"></div>

        <div id="upload-progress-wrap" class="hidden">
            <div id="upload-progress-bar"></div>
        </div>
        <p id="upload-status-text" class="hidden" style="font-size:0.6rem; color:var(--text-muted); margin:-6px 0 10px;">Processing images...</p>

        <input type="file" id="img-upload" multiple accept="image/*" style="font-size:0.65rem; margin-bottom:12px;">
        <input type="text"   id="p-title" placeholder="Product Title">
        <textarea            id="p-desc"  placeholder="Product Description..." style="height:90px; resize:vertical;"></textarea>
        <div style="display:flex; gap:10px;">
            <input type="number" id="p-price" placeholder="Price (â‚±)">
            <input type="number" id="p-stock" placeholder="Stock">
        </div>

        <!-- Dynamic category/subcategory dropdowns injected here via JS -->
        <div id="modal-footer" class="modal-actions"></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CATEGORY MANAGER MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="cat-manager-modal" class="modal-overlay hidden">
    <div class="modal-card" style="max-width:560px;">
        <h2 style="font-family:'Fraunces',serif; font-style:italic; margin-bottom:20px;">Folder Manager</h2>

        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input type="text" id="mgr-new-cat" placeholder="New folder name..." style="flex:1; margin:0;">
            <button onclick="mgrAddFolder()">+ Folder</button>
        </div>

        <div id="mgr-list"></div>

        <div style="margin-top:24px; border-top:2px solid var(--black); padding-top:16px;">
            <button onclick="closeModals()" class="btn-ghost" style="width:100%;">Close</button>
        </div>
    </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SHOP CLOSED OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="shop-closed-overlay" class="hidden">
    <div class="closed-label">Shop Closed</div>
    <p id="shop-closed-msg" class="closed-msg"></p>
    <div class="closed-accent-line"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-page">
    <div class="login-card">
        <span class="logo">RENCE CREATE</span>
        <p class="tagline">An independent art studio â€” Batangas, PH</p>
        <p style="font-size:0.6rem; color:var(--text-muted); margin-bottom:20px; letter-spacing:0.5px;">No data entered here is saved or stored.</p>
        <input type="text" id="username-input" placeholder="Enter your name to browse...">
        <button onclick="enterStore()" style="width:100%; padding:14px;">Browse Products â†’</button>
    </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN SHOP PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="main-page" class="hidden">

    <header>
        <a href="#" class="logo">RENCE CREATE</a>
        <div class="header-right">
            <span id="welcome-msg"></span>
            <button class="cart-btn" onclick="showEditOrder()">EDIT ORDER (<span id="cart-qty-total">0</span>)</button>
        </div>
    </header>

    <!-- Folder + Sub-category navigation -->
    <div class="category-section">
        <div class="folder-nav" id="folder-nav"></div>
        <div class="sub-nav"    id="sub-nav"></div>
    </div>

    <!-- Art grid -->
    <div class="shop-container-new">
        <div class="art-grid" id="shop-grid"></div>
    </div>

    <!-- Sticky cart bar -->
    <div class="cart-bar">
        <div class="cart-bar-info">
            <span>Items: <b id="cart-qty-bar">0</b></span>
            <span>Subtotal: <b>â‚±<span id="cart-subtotal">0.00</span></b></span>
        </div>
        <button onclick="showInvoice()">VIEW INVOICE ğŸ§¾</button>
    </div>

</div><!-- /#main-page -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="admin-page" class="hidden">

    <div class="admin-header">
        <h2>Admin Dashboard</h2>
        <div class="admin-header-actions">
            <button onclick="openCatManager()">ğŸ“ Folders</button>
            <button onclick="openAdminModal()" style="background:#333;">+ Product</button>
            <button onclick="saveAdminChanges()" class="btn-success">Save Changes</button>
            <button onclick="window.location.reload()" class="btn-danger">Logout</button>
        </div>
    </div>

    <!-- Shop Status Control Panel -->
    <div class="shop-status-panel">
        <div>
            <div class="status-label">Shop Status</div>
            <div class="toggle-track" onclick="toggleShopStatus()">
                <div class="toggle-switch" id="status-toggle"></div>
                <span class="toggle-status-text" id="status-toggle-label">OPEN</span>
            </div>
        </div>
        <div style="flex:1; min-width:260px;">
            <div class="status-label">Closed Shop Message</div>
            <textarea id="closed-msg-input" placeholder="e.g. We're restocking! Back on Friday. â™¡" style="height:72px; resize:vertical; font-size:0.7rem; margin:0;"></textarea>
        </div>
    </div>

    <div class="admin-shop-area">
        <div style="display:none;" id="shop-status-inline"><!-- removed --></div>
        <!-- Folder sidebar -->
        <div class="admin-sidebar">
            <div class="admin-sidebar-title">Folders</div>
            <div class="admin-sidebar-buttons" id="admin-sidebar"></div>
        </div>

        <!-- Product table -->
        <div class="admin-table-wrap">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="admin-list"></tbody>
            </table>
        </div>
    </div>

</div><!-- /#admin-page -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer>
    <div class="est-tag">EST. 2026<br>BATANGAS. PH</div>
    <div class="footer-copy">
        DESIGNED BY RENCE CREATE<br>
        Â© ALL RIGHTS RESERVED 2026<br>
        AUTHENTIC QUALITY
    </div>
</footer>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” ALL LOGIC PRESERVED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
    /* â”€â”€â”€ SUPABASE â”€â”€â”€ */
    const SUPABASE_URL = 'https://wogftjsssxfhktgdfvod.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_9yJg8M-wrRXHMfuDnCtFkA_L3n1Ii36';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    /* â”€â”€â”€ STATE â”€â”€â”€ */
    let categories           = { "Stickers": [], "Pins": [] };
    let catalog              = [];
    let currentCategory      = "";
    let currentSubcategory   = "";
    let adminCurrentCategory = "";
    let tempImages           = [];
    let editingIdx           = null;
    let tempQty              = 0;
    let currentSlide         = 0;
    let hasDownloadedSheet   = false;
    let confirmCallback      = null;
    let isShopOpen           = true;   // default: open
    let closedShopMessage    = "";

    /* â”€â”€â”€ DATA LOADING â”€â”€â”€ */
    async function loadAllData() {
        const { data: setts } = await supabaseClient.from('settings').select('*').single();
        if (setts) {
            categories = (setts.category_list && !Array.isArray(setts.category_list))
                ? setts.category_list
                : { "Stickers": [], "Pins": [] };
            // Shop status fields â€” default to open if not yet stored
            isShopOpen        = setts.is_shop_open !== false; // undefined â†’ true
            closedShopMessage = setts.closed_shop_message || "";
        }
        const { data: prods } = await supabaseClient.from('products').select('*');
        if (prods) catalog = prods.map(p => ({ ...p, cartQty: 0 }));

        const firstCat = Object.keys(categories)[0] || "";
        currentCategory      = firstCat;
        adminCurrentCategory = firstCat;
    }

    loadAllData();

    /* â”€â”€â”€ NOTIFICATIONS â”€â”€â”€ */
    let _notifyTimer = null;
    function notify(text, icon = "âœ¨") {
        const box = document.getElementById('custom-alert');
        document.getElementById('alert-text').innerText = text;
        document.getElementById('alert-icon').innerText = icon;
        // Cancel any running dismiss timer so rapid calls don't collide
        if (_notifyTimer) { clearTimeout(_notifyTimer); _notifyTimer = null; }
        // Force a reflow so re-triggering the animation always works
        box.classList.remove('show');
        void box.offsetWidth; // reflow
        box.classList.add('show');
        _notifyTimer = setTimeout(() => {
            box.classList.remove('show');
            _notifyTimer = null;
        }, 3000);
    }

    /* â”€â”€â”€ CONFIRM DIALOG â”€â”€â”€ */
    function customConfirm(msg, callback, isShipping = false) {
        document.getElementById('confirm-msg').innerText = msg;
        const std  = document.getElementById('confirm-standard-btns');
        const ship = document.getElementById('confirm-shipping-btns');

        if (isShipping) { std.classList.add('hidden');  ship.classList.remove('hidden'); }
        else            { std.classList.remove('hidden'); ship.classList.add('hidden'); }

        document.getElementById('confirm-panel').classList.remove('hidden');
        confirmCallback = callback;
    }

    function closeConfirm() { document.getElementById('confirm-panel').classList.add('hidden'); }
    document.getElementById('confirm-yes').onclick = () => { confirmCallback(); closeConfirm(); };

    /* â”€â”€â”€ ENTER STORE â”€â”€â”€ */
    async function enterStore() {
        const name = document.getElementById('username-input').value.trim();
        if (!name) { notify("Please enter your name!", "ğŸ‘‹"); return; }

        await loadAllData();

        if (name === "051022") {
            // Admin bypasses shop-closed gate â€” always enters dashboard
            showAdmin();
        } else if (!isShopOpen) {
            // Shop is closed â€” show full-screen overlay
            document.getElementById('login-page').classList.add('hidden');
            const overlay = document.getElementById('shop-closed-overlay');
            document.getElementById('shop-closed-msg').innerText =
                closedShopMessage || "We'll be back soon. Thank you for your patience! â™¡";
            overlay.classList.remove('hidden');
        } else {
            // Normal user flow
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('main-page').classList.remove('hidden');
            document.getElementById('welcome-msg').innerText = `Hello, ${name.toUpperCase()}`;
            renderFolderNav();
            renderShop();
            updateCartTotals();
        }
    }

    /* â”€â”€â”€ FOLDER NAV (replaces old sidebar) â”€â”€â”€ */
    function renderFolderNav() {
        const nav = document.getElementById('folder-nav');
        nav.innerHTML = '';

        Object.keys(categories).forEach(catName => {
            const span = document.createElement('span');
            span.className = `folder-link${currentCategory === catName ? ' active' : ''}`;
            span.textContent = catName;
            span.onclick = () => {
                currentCategory    = catName;
                currentSubcategory = "";
                renderFolderNav();
                renderSubNav();
                renderShop();
            };
            nav.appendChild(span);
        });

        renderSubNav();
    }

    /* â”€â”€â”€ SUB-NAV (replaces old subcategory bar) â”€â”€â”€ */
    function renderSubNav() {
        const nav  = document.getElementById('sub-nav');
        nav.innerHTML = '';

        const subs = categories[currentCategory] || [];
        if (subs.length === 0) { nav.style.display = 'none'; return; }
        nav.style.display = 'flex';

        const allBtn = document.createElement('button');
        allBtn.className = `sub-pill${currentSubcategory === '' ? ' active' : ''}`;
        allBtn.textContent = 'All';
        allBtn.onclick = () => { currentSubcategory = ""; renderSubNav(); renderShop(); };
        nav.appendChild(allBtn);

        subs.forEach(s => {
            const btn = document.createElement('button');
            btn.className = `sub-pill${currentSubcategory === s ? ' active' : ''}`;
            btn.textContent = s;
            btn.onclick = () => {
                currentSubcategory = (currentSubcategory === s) ? "" : s;
                renderSubNav();
                renderShop();
            };
            nav.appendChild(btn);
        });
    }

    /* â”€â”€â”€ RENDER SHOP (art-grid + art-card, 1:1 icon) â”€â”€â”€ */
    function renderShop() {
        const grid = document.getElementById('shop-grid');
        grid.innerHTML = '';

        const filtered = catalog.filter(item => {
            const matchCat = item.category === currentCategory;
            const matchSub = !currentSubcategory || item.subcategory === currentSubcategory;
            return matchCat && matchSub && item.status === 'live';
        });

        if (filtered.length === 0) {
            grid.innerHTML = `
                <div class="empty-state">
                    <h2>Work In Progress</h2>
                    <p>Check back soon for new drops.</p>
                </div>`;
            return;
        }

        filtered.forEach(item => {
            const idx = catalog.indexOf(item);
            // Always display images[0] as the square 1:1 icon
            const firstImg = item.images?.[0];
            const imgHTML  = firstImg
                ? `<img src="${firstImg}" alt="${item.name}" style="width:100%;height:100%;object-fit:cover;display:block;">`
                : `<div class="img-placeholder">No Image</div>`;

            const subLabel = item.subcategory || item.category || '';

            const card = document.createElement('div');
            card.className = 'art-card';
            card.onclick   = () => openUserView(idx);
            card.innerHTML = `
                <div class="img-container" style="aspect-ratio:1/1;">
                    ${imgHTML}
                </div>
                <div class="card-details">
                    <div class="card-info">
                        <small>${subLabel.toUpperCase()}</small>
                        <h4>${item.name}</h4>
                    </div>
                    <span class="price-tag">â‚±${item.price.toFixed(2)}</span>
                </div>`;
            grid.appendChild(card);
        });
    }

    /* â”€â”€â”€ CART TOTALS â”€â”€â”€ */
    function updateCartTotals() {
        let count = 0, sub = 0;
        catalog.forEach(item => {
            if (item.cartQty > 0) { count += item.cartQty; sub += item.cartQty * item.price; }
        });
        // Header cart count
        const hc = document.getElementById('cart-qty-total');
        if (hc) hc.innerText = count;
        // Cart bar
        const bc = document.getElementById('cart-qty-bar');
        if (bc) bc.innerText = count;
        const bs = document.getElementById('cart-subtotal');
        if (bs) bs.innerText = sub.toFixed(2);
    }

    /* â”€â”€â”€ EDIT ORDER MODAL (header "EDIT ORDER" button) â”€â”€â”€ */
    function showEditOrder() {
        renderEditOrder();
        document.getElementById('edit-order-modal').classList.remove('hidden');
    }

    function renderEditOrder() {
        const list      = document.getElementById('edit-order-list');
        const emptyMsg  = document.getElementById('edit-order-empty');
        const totalEl   = document.getElementById('edit-order-total');
        list.innerHTML  = '';

        const cartItems = catalog.filter(item => item.cartQty > 0);

        if (cartItems.length === 0) {
            emptyMsg.classList.remove('hidden');
            totalEl.innerText = 'â‚±0.00';
            return;
        }
        emptyMsg.classList.add('hidden');

        let runningTotal = 0;

        cartItems.forEach(item => {
            const idx       = catalog.indexOf(item);
            const lineTotal = item.cartQty * item.price;
            runningTotal   += lineTotal;

            const thumbSrc  = item.images?.[0] || '';
            const thumbHTML = thumbSrc
                ? `<img src="${thumbSrc}" style="width:56px;height:56px;object-fit:cover;border:2px solid var(--black);flex-shrink:0;" alt="${item.name}">`
                : `<div style="width:56px;height:56px;background:var(--bg);border:2px solid var(--black);display:flex;align-items:center;justify-content:center;font-size:0.5rem;color:var(--text-muted);flex-shrink:0;">IMG</div>`;

            const row = document.createElement('div');
            row.id = `edit-row-${idx}`;
            row.style.cssText = 'display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--grey);';
            row.innerHTML = `
                ${thumbHTML}
                <div style="flex:1;min-width:0;">
                    <div style="font-weight:900;font-size:0.75rem;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.name}</div>
                    <div style="font-size:0.6rem;color:var(--text-muted);margin-top:2px;">â‚±${item.price.toFixed(2)} each</div>
                </div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <button class="qty-btn" style="width:28px;height:28px;font-size:0.9rem;" onclick="editOrderQty(${idx}, -1)">âˆ’</button>
                    <span style="font-weight:900;font-size:0.85rem;min-width:20px;text-align:center;">${item.cartQty}</span>
                    <button class="qty-btn" style="width:28px;height:28px;font-size:0.9rem;" onclick="editOrderQty(${idx}, 1)">+</button>
                </div>
                <span style="font-weight:900;font-size:0.85rem;background:var(--accent);padding:2px 8px;white-space:nowrap;">â‚±${lineTotal.toFixed(2)}</span>
                <button onclick="editOrderRemove(${idx})" style="background:none;border:none;color:var(--danger);font-size:1.1rem;font-weight:900;padding:0 4px;box-shadow:none;transform:none;min-width:unset;cursor:pointer;" title="Remove">Ã—</button>`;
            list.appendChild(row);
        });

        totalEl.innerText = `â‚±${runningTotal.toFixed(2)}`;
    }

    function editOrderQty(idx, delta) {
        const item   = catalog[idx];
        const newQty = (item.cartQty || 0) + delta;
        if (newQty < 0) return;
        if (newQty > item.stock) { notify("Reached maximum stock", "âš ï¸"); return; }
        item.cartQty = newQty;
        updateCartTotals();
        renderEditOrder();
    }

    function editOrderRemove(idx) {
        catalog[idx].cartQty = 0;
        updateCartTotals();
        renderEditOrder();
        notify("Item removed", "ğŸ—‘ï¸");
    }

    /* â”€â”€â”€ INVOICE / CHECKOUT (VIEW INVOICE â€” clean printable sheet) â”€â”€â”€ */
    function showInvoice() {
        hasDownloadedSheet = false;
        const listCon = document.getElementById('invoice-items-list');
        listCon.innerHTML = '';
        let subtotal = 0, hasItems = false;

        document.getElementById('invoice-date').innerText = new Date().toLocaleString();

        catalog.forEach(item => {
            if (item.cartQty > 0) {
                hasItems = true;
                const itemTotal = item.cartQty * item.price;
                subtotal += itemTotal;
                listCon.innerHTML += `
                    <div class="invoice-row">
                        <div>
                            <div class="item-name">${item.name}</div>
                            <div class="item-qty">â‚±${item.price.toFixed(2)} Ã— ${item.cartQty}</div>
                        </div>
                        <div class="item-price">â‚±${itemTotal.toFixed(2)}</div>
                    </div>`;
            }
        });

        if (!hasItems) { notify("Your cart is empty!", "ğŸ›’"); return; }

        document.getElementById('inv-subtotal').innerText = `â‚±${subtotal.toFixed(2)}`;
        document.getElementById('invoice-modal').classList.remove('hidden');
    }

    function downloadOrderSheet() {
        const sheet = document.getElementById('printable-order-sheet');
        html2canvas(sheet).then(canvas => {
            const link    = document.createElement('a');
            link.download = `order-${Date.now()}.png`;
            link.href     = canvas.toDataURL();
            link.click();
            hasDownloadedSheet = true;
            notify("Order Sheet Saved!", "ğŸ“„");
        });
    }

    function proceedToCheckout() {
        if (!hasDownloadedSheet) { notify("Please download the order sheet first.", "âš ï¸"); return; }
        customConfirm("Where are you ordering from?", choice => {
            const localURL = "https://docs.google.com/forms/d/e/1FAIpQLSdLMu09mL10Gh6BGKQaY3Oa0iJnw2esAbpeVw_d7nrrhnZu2Q/viewform?usp=sharing&ouid=101835408618855772238";
            const intlURL  = "https://docs.google.com/forms/d/e/1FAIpQLSfQ4-Po8E5xW_XyYnB9yFE53qYucCIGBmwzHZTpyKBOVWFHkA/viewform?usp=sharing&ouid=101835408618855772238";
            window.open(choice === 'local' ? localURL : intlURL, '_blank');
        }, true);
    }

    function closeModals() {
        document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden'));
    }

    /* â”€â”€â”€ PRODUCT VIEW MODAL â”€â”€â”€ */
    function openUserView(idx) {
        const item = catalog[idx];
        tempQty = 0; currentSlide = 0;

        document.getElementById('view-title').innerText       = item.name;
        document.getElementById('view-desc').innerText        = item.description || "";
        document.getElementById('view-price').innerText       = `â‚±${item.price.toFixed(2)}`;
        document.getElementById('view-stock-count').innerText = item.stock;

        const wrap = document.getElementById('slider-wrapper');
        wrap.innerHTML = '';
        if (item.images?.length > 0) {
            // Each slide fills the 16:9 container fully
            item.images.forEach(src => {
                wrap.innerHTML += `<img src="${src}" alt="${item.name}" style="width:100%;height:100%;object-fit:cover;flex-shrink:0;">`;
            });
        } else {
            // Fallback fills the full 16:9 area
            wrap.innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:0.7rem;color:var(--text-muted);font-weight:700;text-transform:uppercase;letter-spacing:2px;background:var(--bg);">No Preview Available</div>`;
        }
        wrap.style.transform = 'translateX(0)';

        document.getElementById('qty-plus').onclick = () => {
            if (tempQty < item.stock) { tempQty++; updateQtyDisplay(item); }
            else notify("Reached maximum stock", "âš ï¸");
        };
        document.getElementById('qty-minus').onclick = () => {
            if (tempQty > 0) { tempQty--; updateQtyDisplay(item); }
        };
        document.getElementById('add-to-cart-btn').onclick = () => {
            if (tempQty > 0) {
                item.cartQty = (item.cartQty || 0) + tempQty;
                updateCartTotals();
                notify("Added to cart!", "ğŸ›’");
                closeModals();
            } else notify("Please select a quantity", "â˜ï¸");
        };

        updateQtyDisplay(item);
        document.getElementById('user-modal').classList.remove('hidden');
    }

    function updateQtyDisplay(item) {
        const display  = document.getElementById('view-qty-display');
        const plusBtn  = document.getElementById('qty-plus');
        const minusBtn = document.getElementById('qty-minus');
        if (display)  display.innerText  = tempQty;
        if (minusBtn) minusBtn.style.opacity = tempQty <= 0          ? "0.3" : "1";
        if (plusBtn)  plusBtn.style.opacity  = tempQty >= item.stock ? "0.3" : "1";
    }

    function moveSlider(dir) {
        const wrap = document.getElementById('slider-wrapper');
        const imgs = wrap.querySelectorAll('img');
        if (!imgs.length) return;
        currentSlide = (currentSlide + dir + imgs.length) % imgs.length;
        wrap.style.transform = `translateX(-${currentSlide * 100}%)`;
    }

    /* â”€â”€â”€ ADMIN â”€â”€â”€ */
    function showAdmin() {
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('admin-page').classList.remove('hidden');
        syncShopStatusUI(); // reflect loaded is_shop_open value in toggle
        renderAdminSidebar();
        renderAdminTable();
    }

    /* Sync the toggle button visual state to the isShopOpen variable */
    function syncShopStatusUI() {
        const toggle    = document.getElementById('status-toggle');
        const label     = document.getElementById('status-toggle-label');
        const msgInput  = document.getElementById('closed-msg-input');
        if (!toggle) return;
        if (isShopOpen) {
            toggle.classList.add('on');
            label.textContent = 'OPEN';
            label.className   = 'toggle-status-text open';
        } else {
            toggle.classList.remove('on');
            label.textContent = 'CLOSED';
            label.className   = 'toggle-status-text closed';
        }
        if (msgInput) msgInput.value = closedShopMessage;
    }

    /* Called when admin clicks the toggle */
    function toggleShopStatus() {
        isShopOpen = !isShopOpen;
        syncShopStatusUI();
    }

    function renderAdminSidebar() {
        const sidebar = document.getElementById('admin-sidebar');
        sidebar.innerHTML = '';
        Object.keys(categories).forEach(catName => {
            const btn = document.createElement('button');
            btn.className = `admin-folder-btn${adminCurrentCategory === catName ? ' active' : ''}`;
            btn.textContent = catName;
            btn.onclick = () => {
                adminCurrentCategory = catName;
                renderAdminSidebar();
                renderAdminTable();
            };
            sidebar.appendChild(btn);
        });
    }

    function renderAdminTable() {
        const tbody = document.getElementById('admin-list');
        tbody.innerHTML = '';

        const items = catalog.filter(item => item.category === adminCurrentCategory);

        if (items.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" class="admin-table-empty">No products in this folder yet.</td></tr>`;
            return;
        }

        items.forEach(item => {
            const i = catalog.indexOf(item);
            const isLive = item.status === 'live';
            const tr = document.createElement('tr');
            tr.id = `row-${i}`;
            tr.innerHTML = `
                <td>
                    <div class="prod-name">${item.name}</div>
                    <div class="prod-sub">${item.subcategory || 'â€”'}</div>
                </td>
                <td><span style="background:var(--accent);padding:2px 8px;font-weight:900;">â‚±${item.price.toFixed(2)}</span></td>
                <td>
                    <button onclick="toggleLiveStatus(${i})" class="${isLive ? 'badge-live' : 'badge-off'}">
                        ${isLive ? 'â— LIVE' : 'â—‹ OFF'}
                    </button>
                </td>
                <td><button onclick="openAdminModal(${i})" class="admin-edit-btn">Edit</button></td>`;
            tbody.appendChild(tr);
        });
    }

    function toggleLiveStatus(idx) {
        catalog[idx].status = catalog[idx].status === 'live' ? 'offline' : 'live';
        renderAdminTable();
        syncItemToCloud(idx);
    }

    /* â”€â”€â”€ CATEGORY MANAGER MODAL â”€â”€â”€ */
    function openCatManager() {
        renderCategoryManager();
        document.getElementById('cat-manager-modal').classList.remove('hidden');
    }

    function renderCategoryManager() {
        const list = document.getElementById('mgr-list');
        list.innerHTML = '';

        Object.keys(categories).forEach(cat => {
            const div = document.createElement('div');
            div.className = 'cat-manager-item';
            div.innerHTML = `
                <div class="cat-manager-header">
                    <span class="cat-folder-name">ğŸ“ ${cat}</span>
                    <button class="btn-del-folder" onclick="mgrDelFolder('${cat}')">Delete</button>
                </div>
                <div class="sub-tags-wrap" id="mgr-subs-${cat}"></div>
                <div class="sub-add-row">
                    <input type="text" id="in-sub-${cat}" placeholder="New sub-category...">
                    <button onclick="mgrAddSub('${cat}')">+ Add</button>
                </div>`;
            list.appendChild(div);

            const subWrap = document.getElementById(`mgr-subs-${cat}`);
            categories[cat].forEach(sub => {
                const tag = document.createElement('span');
                tag.className = 'sub-tag';
                tag.innerHTML = `${sub} <b class="sub-tag-del" onclick="mgrDelSub('${cat}','${sub}')">Ã—</b>`;
                subWrap.appendChild(tag);
            });
        });
    }

    function mgrAddFolder() {
        const name = document.getElementById('mgr-new-cat').value.trim();
        if (name && !categories[name]) {
            categories[name] = [];
            document.getElementById('mgr-new-cat').value = '';
            renderCategoryManager();
            renderAdminSidebar();
            notify("Folder created!", "ğŸ“");
        }
    }

    function mgrDelFolder(cat) {
        customConfirm(`Delete "${cat}" and all its sub-categories?`, () => {
            delete categories[cat];
            if (adminCurrentCategory === cat) adminCurrentCategory = Object.keys(categories)[0] || "";
            renderCategoryManager();
            renderAdminSidebar();
            renderAdminTable();
            notify("Folder deleted.", "ğŸ—‘ï¸");
        });
    }

    function mgrAddSub(cat) {
        const name = document.getElementById(`in-sub-${cat}`).value.trim();
        if (name && !categories[cat].includes(name)) {
            categories[cat].push(name);
            renderCategoryManager();
            notify("Sub-category added!");
        }
    }

    function mgrDelSub(cat, sub) {
        categories[cat] = categories[cat].filter(s => s !== sub);
        renderCategoryManager();
    }

    /* â”€â”€â”€ PRODUCT MODAL â”€â”€â”€ */
    function openAdminModal(idx = null) {
        editingIdx = idx;
        tempImages = idx !== null ? [...(catalog[idx].images || [])] : [];

        document.getElementById('p-title').value = idx !== null ? catalog[idx].name        : "";
        document.getElementById('p-desc').value  = idx !== null ? catalog[idx].description : "";
        document.getElementById('p-price').value = idx !== null ? catalog[idx].price       : "";
        document.getElementById('p-stock').value = idx !== null ? catalog[idx].stock       : "";
        document.getElementById('modal-header-text').innerText = idx !== null ? 'Edit Product' : 'New Product';

        // Remove old dynamic fields
        document.querySelectorAll('.dynamic-cat-field').forEach(el => el.remove());

        const titleInput = document.getElementById('p-title');

        const catSelect = document.createElement('select');
        catSelect.id = 'p-category';
        catSelect.className = 'dynamic-cat-field';
        catSelect.onchange = () => updateSubcatDropdown();
        Object.keys(categories).forEach(cat => {
            const opt = document.createElement('option');
            opt.value = opt.innerText = cat;
            if (idx !== null && catalog[idx].category === cat) opt.selected = true;
            catSelect.appendChild(opt);
        });

        const subSelect = document.createElement('select');
        subSelect.id = 'p-subcategory';
        subSelect.className = 'dynamic-cat-field';

        titleInput.after(catSelect, subSelect);
        updateSubcatDropdown(idx !== null ? catalog[idx].subcategory : "");

        // Footer buttons
        const footer = document.getElementById('modal-footer');
        footer.innerHTML = '';
        const saveBtn = document.createElement('button');
        saveBtn.style.flex = '2';
        saveBtn.textContent = idx !== null ? 'Save Changes' : 'Add Product';
        saveBtn.onclick = saveProduct;
        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'btn-ghost';
        cancelBtn.style.flex = '1';
        cancelBtn.textContent = 'Cancel';
        cancelBtn.onclick = closeModals;
        footer.appendChild(saveBtn);
        footer.appendChild(cancelBtn);

        renderAdminImgPreviews();
        document.getElementById('admin-modal').classList.remove('hidden');
    }

    function updateSubcatDropdown(selectedSub = "") {
        const cat = document.getElementById('p-category').value;
        const subSelect = document.getElementById('p-subcategory');
        subSelect.innerHTML = '<option value="">(No Subcategory)</option>';
        (categories[cat] || []).forEach(sub => {
            const opt = document.createElement('option');
            opt.value = opt.innerText = sub;
            if (sub === selectedSub) opt.selected = true;
            subSelect.appendChild(opt);
        });
    }

    function renderAdminImgPreviews() {
        const con = document.getElementById('admin-img-previews');
        con.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const slot = document.createElement('div');
            slot.className = 'img-preview-slot';
            slot.innerHTML = tempImages[i]
                ? `<img src="${tempImages[i]}" alt="Preview ${i+1}">`
                : 'Empty';
            con.appendChild(slot);
        }
    }

    /* â”€â”€â”€ SAVE PRODUCT â”€â”€â”€ */
    async function saveProduct() {
        const name = document.getElementById('p-title').value.trim();
        if (!name) { notify("Product name is required!", "âš ï¸"); return; }

        const data = {
            name,
            description: document.getElementById('p-desc').value,
            price:       parseFloat(document.getElementById('p-price').value) || 0,
            stock:       parseInt(document.getElementById('p-stock').value) || 0,
            images:      tempImages,
            category:    document.getElementById('p-category').value,
            subcategory: document.getElementById('p-subcategory').value,
            status:      editingIdx !== null ? catalog[editingIdx].status : 'offline'
        };

        if (editingIdx !== null) {
            catalog[editingIdx] = { ...catalog[editingIdx], ...data };
        } else {
            catalog.push({ ...data, id: Date.now(), cartQty: 0 });
        }

        closeModals();
        renderAdminTable();
        await syncItemToCloud(editingIdx === null ? catalog.length - 1 : editingIdx);
    }

    /* â”€â”€â”€ CLOUD SYNC â”€â”€â”€ */
    async function syncItemToCloud(idx) {
        try {
            const { cartQty, ...cleanData } = catalog[idx];
            await supabaseClient.from('products').upsert(cleanData);
            notify("Cloud updated!", "â˜ï¸");
        } catch (err) { notify("Sync failed!", "âŒ"); }
    }

    async function saveAdminChanges() {
        const btn = event.target;
        btn.textContent = "â³ Saving...";
        // Read the closed message from the textarea each save
        const msgEl = document.getElementById('closed-msg-input');
        if (msgEl) closedShopMessage = msgEl.value.trim();
        await supabaseClient.from('settings').upsert({
            id:                   1,
            category_list:        categories,
            is_shop_open:         isShopOpen,
            closed_shop_message:  closedShopMessage
        });
        notify("All changes saved!", "ğŸ’¾");
        btn.textContent = "Save Changes";
    }

    /* â”€â”€â”€ IMAGE UPLOAD â”€â”€â”€ */
    document.getElementById('img-upload').addEventListener('change', async function () {
        const files = Array.from(this.files);
        if (!files.length) return;

        const progressWrap = document.getElementById('upload-progress-wrap');
        const progressBar  = document.getElementById('upload-progress-bar');
        const statusText   = document.getElementById('upload-status-text');

        progressWrap.classList.remove('hidden');
        statusText.classList.remove('hidden');
        tempImages = [];

        for (let i = 0; i < Math.min(files.length, 5); i++) {
            await new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    tempImages.push(e.target.result);
                    progressBar.style.width = `${((i + 1) / Math.min(files.length, 5)) * 100}%`;
                    resolve();
                };
                reader.readAsDataURL(files[i]);
            });
        }

        progressWrap.classList.add('hidden');
        statusText.classList.add('hidden');
        renderAdminImgPreviews();
        notify("Images loaded!", "ğŸ–¼ï¸");
    });

    /* â”€â”€â”€ KEYBOARD: close modals with ESC â”€â”€â”€ */
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeModals();
    });

    /* â”€â”€â”€ HEADROOM: hide header on scroll-down, reveal on scroll-up â”€â”€â”€ */
    (function initHeadroom() {
        const hdr         = document.querySelector('header');
        if (!hdr) return;

        let lastScrollY   = window.scrollY;
        let ticking       = false;
        // Threshold before we start hiding â€” avoids hiding on tiny micro-scrolls at the top
        const THRESHOLD   = 60;

        function onScroll() {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    const currentY = window.scrollY;
                    const scrolled = currentY > THRESHOLD; // past the threshold zone
                    const goingDown = currentY > lastScrollY;

                    if (scrolled && goingDown) {
                        // Scrolling DOWN past threshold â†’ hide
                        hdr.classList.add('headroom--hidden');
                    } else {
                        // Scrolling UP, or above threshold â†’ always show
                        hdr.classList.remove('headroom--hidden');
                    }

                    lastScrollY = currentY <= 0 ? 0 : currentY;
                    ticking = false;
                });
                ticking = true;
            }
        }

        window.addEventListener('scroll', onScroll, { passive: true });
    })();
</script>
</body>
</html>
