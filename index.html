<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RENCE CREATE | Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;900&family=Fraunces:ital,opsz,wght@1,9..144,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --bg: #f4f4f4;
            --black: #000000;
            --accent: #00ff66; /* Electric Green */
            --white: #ffffff;
            --primary: #0062ff;
            --border-width: 3px;
            --shadow-subtle: 6px 6px 0px var(--black);
            --shadow-heavy: 12px 12px 0px var(--black);
            --transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Unbounded', sans-serif;
            background-color: var(--bg);
            color: var(--black);
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.4;
        }

        h1, h2, h3, .classy { font-family: 'Fraunces', serif; font-style: italic; font-weight: 400; }

        /* --- UI COMPONENTS --- */
        header {
            position: sticky;
            top: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border: var(--border-width) solid var(--black);
            margin: 0 20px;
            box-shadow: var(--shadow-subtle);
        }

        .logo { font-size: 1.4rem; font-weight: 900; letter-spacing: -1.5px; text-decoration: none; color: var(--black); }

        .container { max-width: 1300px; margin: 0 auto; padding: 40px 20px; }

        /* --- PRODUCT GRID --- */
        .art-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 40px;
        }

        .art-card {
            border: var(--border-width) solid var(--black);
            background: var(--white);
            padding: 15px;
            transition: var(--transition);
            cursor: pointer;
        }

        .art-card:hover { transform: translate(-8px, -8px); box-shadow: var(--shadow-heavy); }

        .img-container {
            width: 100%;
            aspect-ratio: 1/1;
            border: 2px solid var(--black);
            background: #e8e8e8;
            overflow: hidden;
        }

        .img-container img { width: 100%; height: 100%; object-fit: cover; }

        /* --- NAVIGATION PILLS --- */
        .sidebar-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .folder-link {
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 1.1rem;
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            transition: var(--transition);
        }
        .folder-link.active { border-bottom-color: var(--accent); }

        .sub-pill {
            padding: 6px 18px;
            border: 2px solid var(--black);
            border-radius: 50px;
            font-size: 0.65rem;
            font-weight: 900;
            background: transparent;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
        }
        .sub-pill.active { background: var(--black); color: var(--white); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .checkout-card {
            background: var(--white);
            border: var(--border-width) solid var(--black);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 15px 15px 0px var(--accent);
            max-height: 90vh;
            overflow-y: auto;
        }

        .btn-action {
            width: 100%; padding: 18px; background: var(--black); color: var(--white);
            font-family: 'Unbounded'; font-weight: 900; text-transform: uppercase;
            border: none; cursor: pointer; margin-top: 10px; transition: var(--transition);
        }

        .btn-action:hover { transform: translate(-3px, -3px); box-shadow: 5px 5px 0px var(--accent); }
        .btn-download { background: var(--accent); color: var(--black); border: 3px solid var(--black); }

        .hidden { display: none !important; }

        /* --- NOTIFICATION --- */
        #custom-alert {
            position: fixed; bottom: 30px; right: 30px; background: var(--black); color: white;
            padding: 15px 25px; border: 2px solid var(--accent); transform: translateY(150%);
            transition: 0.5s; z-index: 9999;
        }
        #custom-alert.show { transform: translateY(0); }

        /* --- ADMIN DASHBOARD --- */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.8rem; }
        .admin-table td, .admin-table th { padding: 12px; border: 1px solid #ddd; text-align: left; }
        input, select, textarea { 
            width: 100%; padding: 12px; border: 2px solid var(--black); 
            font-family: 'Unbounded'; margin-bottom: 10px; font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div id="custom-alert">
        <span id="alert-icon">‚ú®</span> <span id="alert-text">Action Successful</span>
    </div>

    <div id="login-page">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; padding: 20px;">
            <div class="checkout-card" style="max-width: 400px; text-align: center;">
                <h1 class="logo">RENCE CREATE</h1>
                <p class="classy">Enter your name to browse the gallery</p>
                <input type="text" id="username-input" placeholder="Your Name">
                <button class="btn-action" onclick="enterStore()">ENTER GALLERY</button>
                <hr style="margin: 25px 0; border: 1px dashed #000;">
                <button onclick="showAdminLogin()" style="background:none; border:none; cursor:pointer; font-size: 0.7rem; font-weight: 900; text-decoration: underline;">ADMIN/STUDIO ACCESS</button>
            </div>
        </div>
    </div>

    <div id="admin-login-modal" class="modal-overlay hidden">
        <div class="checkout-card" style="max-width: 350px;">
            <h2 class="classy">Studio Login</h2>
            <input type="text" id="admin-user" placeholder="Username">
            <input type="password" id="admin-pass" placeholder="Password">
            <button class="btn-action" onclick="attemptAdminLogin()">UNLOCK STUDIO</button>
            <button onclick="closeModals()" style="width: 100%; background: none; border: none; margin-top: 10px; cursor: pointer; font-size: 0.7rem; font-weight: 900;">CANCEL</button>
        </div>
    </div>

    <div id="main-page" class="hidden">
        <header>
            <div class="logo">RENCE CREATE</div>
            <button class="btn-action" onclick="showInvoice()" style="width: auto; padding: 10px 15px; margin: 0; font-size: 0.7rem;">BAG (<span id="cart-qty-total">0</span>)</button>
        </header>

        <div class="container">
            <div id="welcome-msg" style="font-size: 0.7rem; font-weight: 900; margin-bottom: 20px; opacity: 0.6;"></div>
            <div class="sidebar-scroll" id="main-sidebar"></div>
            <div id="subcategory-bar" style="display: flex; gap: 10px; margin: 10px 0 30px 0; overflow-x: auto; padding-bottom: 10px;"></div>
            <div id="shop-grid" class="art-grid"></div>
        </div>
    </div>

    <div id="admin-page" class="hidden">
        <div class="container">
            <div class="checkout-card" style="max-width: 100%; box-shadow: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="classy">STUDIO MANAGER</h2>
                    <button class="btn-action" onclick="window.location.reload()" style="width:auto; padding: 5px 15px; font-size: 0.7rem;">EXIT STUDIO</button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="border: 2px solid #000; padding: 15px;">
                        <h4 style="margin:0 0 10px 0;">+ New Folder</h4>
                        <div style="display: flex; gap: 5px;">
                            <input type="text" id="mgr-new-cat" style="margin:0;">
                            <button class="btn-action" onclick="mgrAddFolder()" style="margin:0; width:auto; padding: 0 15px;">ADD</button>
                        </div>
                    </div>
                    <div id="mgr-list" style="border: 2px solid #000; padding: 15px; max-height: 150px; overflow-y: auto;"></div>
                </div>

                <div class="sidebar-scroll" id="admin-sidebar"></div>
                <button class="btn-action" onclick="openAdminModal()" style="background: var(--primary);">+ ADD NEW PRODUCT</button>
                <button class="btn-action" onclick="saveAdminChanges()" style="background: var(--accent); color: #000;">SAVE GLOBAL SETTINGS</button>
                
                <table class="admin-table">
                    <thead><tr><th>Product</th><th>Price</th><th>Stock</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody id="admin-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="user-modal" class="modal-overlay hidden">
        <div class="checkout-card">
            <div id="slider-wrapper" class="img-container" style="margin-bottom: 15px;"></div>
            <h2 id="view-title" class="classy" style="margin:0;"></h2>
            <p id="view-desc" style="font-size: 0.8rem; margin: 15px 0; min-height: 50px;"></p>
            <div style="display: flex; justify-content: space-between; align-items: center; border-top: 2px solid #000; padding-top: 15px;">
                <h3 id="view-price" style="margin:0;"></h3>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="btn-action" id="qty-minus" style="width: 40px; margin:0; padding: 10px;">-</button>
                    <span id="view-qty-display" style="font-weight: 900;">0</span>
                    <button class="btn-action" id="qty-plus" style="width: 40px; margin:0; padding: 10px;">+</button>
                </div>
            </div>
            <button id="add-to-cart-btn" class="btn-action">ADD TO BAG</button>
            <button onclick="closeModals()" style="width: 100%; background: none; border: none; margin-top: 10px; cursor: pointer; font-size: 0.7rem; font-weight: 900;">CLOSE</button>
        </div>
    </div>

    <div id="invoice-modal" class="modal-overlay hidden">
        <div class="checkout-card">
            <div id="printable-order-sheet" style="padding: 30px; border: 2px dashed #000; background: #fff;">
                <h2 class="classy" style="text-align: center; margin: 0 0 20px 0;">ORDER SHEET</h2>
                <div id="invoice-items-list"></div>
                <hr style="border: none; border-top: 2px dashed #000; margin: 15px 0;">
                <div style="display: flex; justify-content: space-between; font-weight: 900; font-size: 1.2rem;">
                    <span>TOTAL</span>
                    <span id="inv-subtotal">‚Ç±0.00</span>
                </div>
                <p style="font-size: 0.6rem; text-align: center; margin-top: 20px; font-style: italic;">Save this image to upload in the checkout form.</p>
            </div>
            <button class="btn-action btn-download" onclick="downloadOrderSheet()">1. SAVE ORDER SHEET (IMAGE)</button>
            <button class="btn-action" onclick="proceedToCheckout()">2. GO TO CHECKOUT FORM</button>
            <button onclick="closeModals()" style="width: 100%; background: none; border: none; margin-top: 10px; cursor: pointer; font-size: 0.7rem; font-weight: 900;">GO BACK</button>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay hidden">
        <div class="checkout-card">
            <h2 class="classy" id="modal-title">Product Panel</h2>
            <input type="text" id="p-title" placeholder="Product Name">
            <textarea id="p-desc" placeholder="Description"></textarea>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="p-price" placeholder="Price">
                <input type="number" id="p-stock" placeholder="Stock">
            </div>
            <div id="admin-cat-fields"></div>
            <div id="admin-img-previews" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px;"></div>
            <input type="file" id="img-upload" multiple accept="image/*">
            <button class="btn-action" onclick="saveProduct()">SAVE PRODUCT</button>
            <button onclick="closeModals()" style="width: 100%; background: none; border: none; margin-top: 10px; cursor: pointer; font-size: 0.7rem; font-weight: 900;">CANCEL</button>
        </div>
    </div>

    <script>
        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://wogftjsssxfhktgdfvod.supabase.co'; // Paste from CODE.txt
        const SUPABASE_KEY = 'sb_publishable_9yJg8M-wrRXHMfuDnCtFkA_L3n1Ii36'; // Paste from CODE.txt
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let categories = { "Stickers": [], "Pins": [] };
        let catalog = [];
        let currentCategory = "";
        let currentSubcategory = "";
        let adminCurrentCategory = "";
        let tempImages = [];
        let editingIdx = null;
        let tempQty = 0;
        let hasDownloadedSheet = false;

        async function loadAllData() {
            const { data: setts } = await supabaseClient.from('settings').select('*').single();
            if (setts) categories = setts.category_list || { "Stickers": [], "Pins": [] };
            
            const { data: prods } = await supabaseClient.from('products').select('*');
            if (prods) catalog = prods.map(p => ({ ...p, cartQty: 0 }));
            
            const firstCat = Object.keys(categories)[0] || "";
            currentCategory = firstCat;
            adminCurrentCategory = firstCat;
        }

        async function enterStore() {
            const name = document.getElementById('username-input').value;
            if (!name) return notify("Please enter your name", "‚òùÔ∏è");
            await loadAllData();
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('main-page').classList.remove('hidden');
            document.getElementById('welcome-msg').innerText = `GREETINGS, ${name.toUpperCase()}`;
            renderSidebar('main-sidebar', false);
            renderShop();
        }

        function showAdminLogin() { document.getElementById('admin-login-modal').classList.remove('hidden'); }

        async function attemptAdminLogin() {
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-pass').value;

            // Simple Hashed check: user "admin", pass "create2026"
            if (user === "admin" && btoa(pass) === "Y3JlYXRlMjAyNg==") {
                await loadAllData();
                closeModals();
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('admin-page').classList.remove('hidden');
                renderSidebar('admin-sidebar', true);
                renderAdminTable();
                renderCategoryManager();
            } else {
                notify("Invalid Credentials", "‚ùå");
            }
        }

        // --- CORE UI RENDERING ---
        function renderSidebar(targetId, isAdmin) {
            const sidebar = document.getElementById(targetId);
            sidebar.innerHTML = '';
            Object.keys(categories).forEach(cat => {
                const span = document.createElement('span');
                const active = isAdmin ? (adminCurrentCategory === cat) : (currentCategory === cat);
                span.className = `folder-link ${active ? 'active' : ''}`;
                span.innerText = cat;
                span.onclick = () => {
                    if (isAdmin) { adminCurrentCategory = cat; renderSidebar('admin-sidebar', true); renderAdminTable(); }
                    else { currentCategory = cat; currentSubcategory = ""; renderSidebar('main-sidebar', false); renderShop(); }
                };
                sidebar.appendChild(span);
            });
            if(!isAdmin) renderSubNav();
        }

        function renderSubNav() {
            const bar = document.getElementById('subcategory-bar');
            bar.innerHTML = '';
            const subs = categories[currentCategory] || [];
            if(subs.length > 0) {
                const allBtn = document.createElement('button');
                allBtn.className = `sub-pill ${currentSubcategory === "" ? "active" : ""}`;
                allBtn.innerText = "All";
                allBtn.onclick = () => { currentSubcategory = ""; renderSubNav(); renderShop(); };
                bar.appendChild(allBtn);

                subs.forEach(s => {
                    const btn = document.createElement('button');
                    btn.className = `sub-pill ${currentSubcategory === s ? "active" : ""}`;
                    btn.innerText = s;
                    btn.onclick = () => { currentSubcategory = s; renderSubNav(); renderShop(); };
                    bar.appendChild(btn);
                });
            }
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            const filtered = catalog.filter(item => 
                item.category === currentCategory && 
                (!currentSubcategory || item.subcategory === currentSubcategory) && 
                item.status === 'live'
            );
            
            if (filtered.length === 0) {
                grid.innerHTML = '<p class="classy" style="grid-column: 1/-1; text-align: center; padding: 50px;">Nothing here yet...</p>';
                return;
            }

            filtered.forEach(item => {
                const idx = catalog.indexOf(item);
                grid.innerHTML += `
                    <div class="art-card" onclick="openUserView(${idx})">
                        <div class="img-container">
                            <img src="${item.images?.[0] || ''}">
                        </div>
                        <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: flex-end;">
                            <div>
                                <small style="font-weight: 900; opacity: 0.5; font-size: 0.6rem;">${item.subcategory || 'GENERAL'}</small>
                                <h4 style="margin: 0; text-transform: uppercase; font-size: 1rem;">${item.name}</h4>
                            </div>
                            <p style="margin: 0; font-weight: 900; background: var(--accent); padding: 0 5px;">‚Ç±${item.price}</p>
                        </div>
                    </div>`;
            });
        }

        function openUserView(idx) {
            const item = catalog[idx];
            tempQty = 0;
            document.getElementById('view-title').innerText = item.name;
            document.getElementById('view-desc').innerText = item.description || "";
            document.getElementById('view-price').innerText = `‚Ç±${item.price}`;
            document.getElementById('slider-wrapper').innerHTML = `<img src="${item.images?.[0] || ''}" style="width:100%; height:100%; object-fit:cover;">`;
            
            document.getElementById('qty-plus').onclick = () => { if(tempQty < item.stock) { tempQty++; updateQtyDisplay(item); } };
            document.getElementById('qty-minus').onclick = () => { if(tempQty > 0) { tempQty--; updateQtyDisplay(item); } };
            document.getElementById('add-to-cart-btn').onclick = () => {
                if(tempQty > 0) {
                    item.cartQty += tempQty;
                    updateCartTotals();
                    notify("Added to bag!", "üõí");
                    closeModals();
                } else {
                    notify("Set quantity first", "‚òùÔ∏è");
                }
            };
            updateQtyDisplay(item);
            document.getElementById('user-modal').classList.remove('hidden');
        }

        function updateQtyDisplay(item) {
            document.getElementById('view-qty-display').innerText = tempQty;
            document.getElementById('qty-minus').style.opacity = tempQty <= 0 ? "0.3" : "1";
            document.getElementById('qty-plus').style.opacity = tempQty >= item.stock ? "0.3" : "1";
        }

        function updateCartTotals() {
            let total = 0;
            catalog.forEach(i => total += (i.cartQty || 0));
            document.getElementById('cart-qty-total').innerText = total;
        }

        function showInvoice() {
            const listCon = document.getElementById('invoice-items-list');
            listCon.innerHTML = '';
            let subtotal = 0;
            catalog.forEach(item => {
                if(item.cartQty > 0) {
                    subtotal += (item.cartQty * item.price);
                    listCon.innerHTML += `<div style="display:flex; justify-content:space-between; margin:10px 0; font-size: 0.9rem;">
                        <span>${item.name} x ${item.cartQty}</span>
                        <span>‚Ç±${(item.cartQty * item.price).toFixed(2)}</span>
                    </div>`;
                }
            });
            if(subtotal === 0) return notify("Your bag is empty", "üõí");
            document.getElementById('inv-subtotal').innerText = `‚Ç±${subtotal.toFixed(2)}`;
            document.getElementById('invoice-modal').classList.remove('hidden');
        }

        function downloadOrderSheet() {
            const sheet = document.getElementById('printable-order-sheet');
            html2canvas(sheet).then(canvas => {
                const link = document.createElement('a');
                link.download = `RENCE-ORDER-${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
                hasDownloadedSheet = true;
                notify("Sheet saved to gallery!");
            });
        }

        function proceedToCheckout() {
            if (!hasDownloadedSheet) return notify("Save order sheet first!", "‚ö†Ô∏è");
            window.open("https://docs.google.com/forms/d/e/1FAIpQLSdLMu09mL10Gh6BGKQaY3Oa0iJnw2esAbpeVw_d7nrrhnZu2Q/viewform", "_blank");
        }

        // --- ADMIN FUNCTIONS (AS PER CODE.TXT) ---
        function renderAdminTable() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';
            catalog.forEach((item, i) => {
                if(item.category === adminCurrentCategory) {
                    list.innerHTML += `<tr>
                        <td>${item.name}</td>
                        <td>‚Ç±${item.price}</td>
                        <td>${item.stock}</td>
                        <td style="color:${item.status === 'live' ? 'green' : 'red'}; font-weight:900;">${item.status.toUpperCase()}</td>
                        <td><button onclick="openAdminModal(${i})" style="cursor:pointer;">EDIT</button></td>
                    </tr>`;
                }
            });
        }

        function renderCategoryManager() {
            const con = document.getElementById('mgr-list');
            con.innerHTML = '';
            Object.keys(categories).forEach(cat => {
                con.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span>${cat}</span>
                    <button onclick="mgrDelFolder('${cat}')" style="color:red; background:none; border:none; cursor:pointer;">‚úñ</button>
                </div>`;
            });
        }

        function notify(text, icon = "‚ú®") {
            const alertBox = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerText = text;
            document.getElementById('alert-icon').innerText = icon;
            alertBox.classList.add('show');
            setTimeout(() => alertBox.classList.remove('show'), 3000);
        }

        function closeModals() { 
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden'));
        }

        // Initialize empty catalog if no data found
        window.onload = async () => {
            // Data is loaded via button clicks to save bandwidth
        };
    </script>
</body>
</html>

